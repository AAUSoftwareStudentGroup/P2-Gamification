(function(){"use strict";Bridge.define("ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules",{statics:{insertSuggestion:function(indexes,result,suggestion){for(var i=0;i<indexes.getCount();i++)result.removeAt(indexes.getItem(i)-i);return result.insert(indexes.getItem(0),suggestion),result},productToExponentRule:function(expression,selection){var product,suggestion,indexes,result;return selection.getCount()<2?null:(product=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),Bridge.hasValue(product)&&product.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply&&Bridge.Linq.Enumerable.from(selection).takeWhile(function(e){return ThreeOneSevenBee.Model.Expression.ExpressionBase.op_Equality(selection.getItem(0),e)&&e.getParent()===expression}).count()===selection.getCount())?(suggestion=new ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression(selection.getItem(0).clone(),new ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression(selection.getCount()),ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.power),product.getCount()===selection.getCount()?new ThreeOneSevenBee.Model.Expression.Identity(suggestion,suggestion):(indexes=Bridge.Linq.Enumerable.from(selection).select(function(s){return product.indexOfReference(s)}).where($_.ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules.f1).toList(Bridge.Int),indexes.sort(),result=Bridge.as(product.clone(),ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),result=Bridge.get(ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules).insertSuggestion(indexes,result,suggestion),new ThreeOneSevenBee.Model.Expression.Identity(suggestion,result))):null},exponentToProductRule:function(expression,selection){var exponent,numericExpression,number,result,i;if(selection.getCount()!==2)return null;if(exponent=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),Bridge.hasValue(exponent)&&exponent.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.power&&selection.getItem(0).getParent()===exponent&&selection.getItem(1).getParent()===exponent){if(numericExpression=Bridge.as(exponent.getRight(),ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression),!Bridge.hasValue(numericExpression))return null;if(number=Bridge.Int.trunc(numericExpression.number),number===0)return new ThreeOneSevenBee.Model.Expression.Identity(new ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression(1),new ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression(1));if(number===1)return new ThreeOneSevenBee.Model.Expression.Identity(exponent.getLeft().clone(),exponent.getLeft().clone());if(number>1){for(result=new ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression("constructor",ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply,exponent.getLeft().clone(),exponent.getLeft().clone()),i=2;i<number;i++)result.add(exponent.getLeft().clone());return new ThreeOneSevenBee.Model.Expression.Identity(result,result)}}return null},numericVariadicRule:function(expression,selection){var $t,variadicExpression,sum,operation,selected,numericExpression,indexes,result;if(selection.getCount()<2)return null;if(variadicExpression=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),Bridge.hasValue(variadicExpression)){if(variadicExpression.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply)sum=1,operation=$_.ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules.f2;else if(variadicExpression.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.add)sum=0,operation=$_.ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules.f3;else return null;for($t=Bridge.getEnumerator(selection);$t.moveNext();){if(selected=$t.getCurrent(),selected.getParent()===variadicExpression==!1)return null;if(numericExpression=Bridge.as(selected,ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression),Bridge.hasValue(numericExpression))sum=operation(sum,Bridge.Int.trunc(numericExpression.number));else return null}return variadicExpression.getCount()===selection.getCount()?new ThreeOneSevenBee.Model.Expression.Identity(new ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression(sum),new ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression(sum)):(indexes=Bridge.Linq.Enumerable.from(selection).select(function(s){return variadicExpression.indexOfReference(s)}).where($_.ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules.f1).toList(Bridge.Int),indexes.sort(),result=Bridge.as(variadicExpression.clone(),ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),result=Bridge.get(ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules).insertSuggestion(indexes,result,new ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression(sum)),new ThreeOneSevenBee.Model.Expression.Identity(new ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression(sum),result))}return null},numericBinaryRule:function(expression,selection){var binaryExpression,numericLeft,numericRight,result,positiveResult;if(selection.getCount()<2)return null;if(binaryExpression=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),Bridge.hasValue(binaryExpression)&&selection.getItem(0).getParent()===binaryExpression&&selection.getItem(1).getParent()===binaryExpression&&(numericLeft=Bridge.as(binaryExpression.getLeft(),ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression),numericRight=Bridge.as(binaryExpression.getRight(),ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression),Bridge.hasValue(numericLeft)&&Bridge.hasValue(numericRight))){if(binaryExpression.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.subtract)result=new ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression(numericLeft.number-numericRight.number);else if(binaryExpression.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.power)result=new ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression(Math.pow(numericLeft.number,numericRight.number));else return null;return result.number>=0?new ThreeOneSevenBee.Model.Expression.Identity(result,result):(result.number*=-1,positiveResult=new ThreeOneSevenBee.Model.Expression.Expressions.UnaryMinusExpression(result),new ThreeOneSevenBee.Model.Expression.Identity(positiveResult,positiveResult))}return null},variableWithNegativeExponent:function(expression,selection){var binaryexpression,unaryexpression;if(selection.getCount()<2)return null;if(binaryexpression=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),Bridge.hasValue(binaryexpression)&&binaryexpression.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.power&&selection.getItem(0).getParent()===binaryexpression&&selection.getItem(1).getParent()===binaryexpression&&(unaryexpression=Bridge.as(binaryexpression.getRight(),ThreeOneSevenBee.Model.Expression.Expressions.UnaryMinusExpression),Bridge.hasValue(unaryexpression)&&Bridge.hasValue(binaryexpression.getLeft())&&Bridge.hasValue(binaryexpression.getRight()))){var serializer=new ThreeOneSevenBee.Model.Expression.ExpressionSerializer,power=new ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression(binaryexpression.getLeft().clone(),unaryexpression.getExpression().clone(),ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.power),mysuggestion=new ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression(new ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression(1),power,ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.divide);return new ThreeOneSevenBee.Model.Expression.Identity(mysuggestion,mysuggestion)}return null},reverseVariableWithNegativeExponent:function(expression){var binaryexpression=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),numericexpression,power,unaryminus,mysuggestion;return Bridge.hasValue(binaryexpression)&&binaryexpression.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.divide&&(numericexpression=Bridge.as(binaryexpression.getLeft(),ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression),power=Bridge.as(binaryexpression.getRight(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryExpression),Bridge.hasValue(numericexpression)&&numericexpression.getValue()==="1"&&Bridge.hasValue(power))?(unaryminus=new ThreeOneSevenBee.Model.Expression.Expressions.UnaryMinusExpression(power.getRight()),mysuggestion=new ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression(power.getLeft().clone(),unaryminus.clone(),ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.power),new ThreeOneSevenBee.Model.Expression.Identity(mysuggestion,mysuggestion)):null},addFractionsWithSameNumerators:function(expression,selection){var $t,$t1,variadicExpression,firstFraction,secondFraction,numeratorList,selected,fraction,suggestionNumerator,i,suggestion,list,temp,i1,indexes,result;if(selection.getCount()<2)return null;if(variadicExpression=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),(Bridge.hasValue(variadicExpression)&&variadicExpression.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.add||variadicExpression.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.subtract)&&(firstFraction=Bridge.as(selection.getItem(0),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),secondFraction=Bridge.as(selection.getItem(1),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),Bridge.hasValue(firstFraction)&&Bridge.hasValue(secondFraction)&&firstFraction.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.divide&&secondFraction.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.divide)){for(numeratorList=new Bridge.List$1(ThreeOneSevenBee.Model.Expression.ExpressionBase)(),numeratorList.add(firstFraction.getLeft().clone()),numeratorList.add(secondFraction.getLeft().clone()),$t=Bridge.getEnumerator(Bridge.Linq.Enumerable.from(selection).skip(2));$t.moveNext();)if(selected=$t.getCurrent(),fraction=Bridge.as(selected,ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),Bridge.hasValue(fraction)&&fraction.getParent()===variadicExpression&&ThreeOneSevenBee.Model.Expression.ExpressionBase.op_Equality(fraction.getRight(),firstFraction.getRight()))Bridge.hasValue(Bridge.as(fraction.getLeft(),ThreeOneSevenBee.Model.Expression.Expressions.UnaryMinusExpression))?numeratorList.add(Bridge.as(fraction.getLeft().clone(),ThreeOneSevenBee.Model.Expression.Expressions.UnaryMinusExpression)):numeratorList.add(fraction.getLeft().clone());else return null;for(suggestionNumerator=new ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression("constructor",ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.add,firstFraction.getLeft().clone(),secondFraction.getLeft().clone()),$t1=Bridge.getEnumerator(Bridge.Linq.Enumerable.from(numeratorList).skip(2));$t1.moveNext();)i=$t1.getCurrent(),suggestionNumerator.add(i);if(suggestion=new ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression(suggestionNumerator,firstFraction.getRight().clone(),ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.divide),variadicExpression.getCount()===selection.getCount())return new ThreeOneSevenBee.Model.Expression.Identity(suggestion,suggestion);for(list=new Bridge.List$1(ThreeOneSevenBee.Model.Expression.ExpressionBase)(),temp=null,i1=0;i1<selection.getCount();i1++)temp=Bridge.as(selection.getItem(i1),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),Bridge.hasValue(temp)&&list.add(temp);return indexes=Bridge.Linq.Enumerable.from(list).select(function(s){return variadicExpression.indexOfReference(s)}).where($_.ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules.f4).toList(Bridge.Int),indexes.sort(),result=Bridge.as(variadicExpression.clone(),ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),result=Bridge.get(ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules).insertSuggestion(indexes,result,suggestion),new ThreeOneSevenBee.Model.Expression.Identity(suggestion,result)}return null},exponentProduct:function(expression,selection){var $t,$t1,$t2,$t3,variadicExpression,numeratorList,j,parent,numbers,i,suggestionNumerator,i1,i2,i3,i4,suggestion,i5,indexes,indexes2,result;if(selection.getCount()<2)return null;if(variadicExpression=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),Bridge.hasValue(variadicExpression)&&variadicExpression.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply){var baseSelection=selection.getItem(0).clone(),variableIsPowerToOne=new Bridge.List$1(ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression)(),powerToOneCount=0;if((Bridge.is(selection.getItem(0).getParent(),ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression)&&powerToOneCount++,Bridge.is(selection.getItem(1).getParent(),ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression)&&powerToOneCount++,powerToOneCount===2)||!Bridge.Linq.Enumerable.from(selection).all($_.ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules.f5))return null;if(Bridge.is(selection.getItem(0).getParent(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression)&&Bridge.is(selection.getItem(1).getParent(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression)||powerToOneCount>0){for(numeratorList=new Bridge.List$1(ThreeOneSevenBee.Model.Expression.ExpressionBase)(),j=0;j<selection.getCount();j++)if(ThreeOneSevenBee.Model.Expression.ExpressionBase.op_Equality(baseSelection,selection.getItem(j)))if(parent=Bridge.as(selection.getItem(j).getParent(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),Bridge.hasValue(parent)&&parent.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.power){if(Bridge.is(parent.getRight(),ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression))numeratorList.add(parent.getRight().clone());else if(Bridge.is(parent.getRight(),ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression)&&(numbers=Bridge.cast(parent.getRight().clone(),ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),numbers.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.add))for(i=0;i<numbers.getCount();i++)numeratorList.add(numbers.getItem(i))}else Bridge.is(selection.getItem(j).getParent(),ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression)&&variableIsPowerToOne.add(new ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression(1));else return null;if(suggestionNumerator=null,Bridge.is(selection.getItem(0).getParent(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression)&&Bridge.is(selection.getItem(1).getParent(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression)){for(suggestionNumerator=new ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression("constructor",ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.add,numeratorList.getItem(0),numeratorList.getItem(1)),$t=Bridge.getEnumerator(Bridge.Linq.Enumerable.from(numeratorList).skip(2));$t.moveNext();)i1=$t.getCurrent(),suggestionNumerator.add(i1);for($t1=Bridge.getEnumerator(variableIsPowerToOne);$t1.moveNext();)i2=$t1.getCurrent(),suggestionNumerator.add(i2)}else if(Bridge.is(selection.getItem(0).getParent(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression)&&powerToOneCount===1||Bridge.is(selection.getItem(1).getParent(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression)&&powerToOneCount===1){for(suggestionNumerator=new ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression("constructor",ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.add,numeratorList.getItem(0),variableIsPowerToOne.getItem(0)),$t2=Bridge.getEnumerator(Bridge.Linq.Enumerable.from(numeratorList).skip(1));$t2.moveNext();)i3=$t2.getCurrent(),suggestionNumerator.add(i3);for($t3=Bridge.getEnumerator(Bridge.Linq.Enumerable.from(variableIsPowerToOne).skip(1));$t3.moveNext();)i4=$t3.getCurrent(),suggestionNumerator.add(i4)}if(variableIsPowerToOne.getCount()===selection.getCount())return null;if(suggestion=new ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression(baseSelection.clone(),suggestionNumerator,ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.power),variadicExpression.getCount()===selection.getCount())return new ThreeOneSevenBee.Model.Expression.Identity(suggestion,suggestion);var list=new Bridge.List$1(ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression)(),list2=new Bridge.List$1(ThreeOneSevenBee.Model.Expression.ExpressionBase)(),temp=null,temp2=null;for(i5=0;i5<selection.getCount();i5++)temp=Bridge.as(selection.getItem(i5).getParent(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),Bridge.hasValue(temp)?list.add(temp):(temp2=Bridge.as(selection.getItem(i5).getParent(),ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),Bridge.hasValue(temp2)&&list2.add(selection.getItem(i5)));return indexes=Bridge.Linq.Enumerable.from(list).select(function(s){return variadicExpression.indexOfReference(s)}).where($_.ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules.f6).toList(Bridge.Int),indexes2=Bridge.Linq.Enumerable.from(list2).select(function(s){return variadicExpression.indexOfReference(s)}).where($_.ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules.f6).toList(Bridge.Int),indexes=Bridge.Linq.Enumerable.from(indexes).concat(indexes2).toList(Bridge.Int),indexes.sort(),result=Bridge.as(variadicExpression.clone(),ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),result=Bridge.get(ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules).insertSuggestion(indexes,result,suggestion),new ThreeOneSevenBee.Model.Expression.Identity(suggestion,result)}}return null},productParenthesis:function(expression,selection){var $t,$t1,variadicExpression=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),common,rest,op,subOp,suggestion,result;if(!Bridge.hasValue(variadicExpression)||variadicExpression.getType()!==ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.add||selection.getCount()<2||!Bridge.Linq.Enumerable.from(selection).all($_.ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules.f7)||(common=Bridge.Linq.Enumerable.from(Bridge.Linq.Enumerable.from(selection).select(function(x){return Bridge.cast(x,Bridge.IEnumerable$1(ThreeOneSevenBee.Model.Expression.ExpressionBase))}).aggregate($_.ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules.f8)).toList(ThreeOneSevenBee.Model.Expression.ExpressionBase),!Bridge.Linq.Enumerable.from(common).any()))return null;for(variadicExpression=Bridge.cast(variadicExpression.clone(),ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),rest=new Bridge.List$1(ThreeOneSevenBee.Model.Expression.ExpressionBase)(),$t=Bridge.getEnumerator(Bridge.Linq.Enumerable.from(selection).select(function(x){return Bridge.cast(x,ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression)}));$t.moveNext();)for(op=$t.getCurrent(),$t1=Bridge.getEnumerator(op);$t1.moveNext();)(subOp=$t1.getCurrent(),ThreeOneSevenBee.Model.Expression.ExpressionBase.op_Equality(subOp,Bridge.Linq.Enumerable.from(common).first()))||(rest.add(subOp),Bridge.hasValue(variadicExpression)&&variadicExpression.remove(op));return suggestion=new ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression("constructor",ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply,Bridge.Linq.Enumerable.from(common).first(),new ThreeOneSevenBee.Model.Expression.Expressions.DelimiterExpression(new ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression("constructor",ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.add,rest.getItem(0),rest.getItem(1),[Bridge.Linq.Enumerable.from(rest).skip(2).toArray()]))),result=new ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression("constructor",ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.add,variadicExpression,suggestion),new ThreeOneSevenBee.Model.Expression.Identity(suggestion,result)},splittingFractions:function(expression,selection){var $t,$t1,binaryExpression,test,numerators,fractionList,i,suggestion,i1;if(selection.getCount()!==1||(binaryExpression=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),test=Bridge.as(selection.getItem(0),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),!binaryExpression===test))return null;if(Bridge.hasValue(binaryExpression)&&binaryExpression.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.divide&&(numerators=Bridge.as(binaryExpression.getLeft().clone(),ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),Bridge.hasValue(numerators)&&numerators.getCount()>1)){for(fractionList=new Bridge.List$1(ThreeOneSevenBee.Model.Expression.ExpressionBase)(),$t=Bridge.getEnumerator(numerators);$t.moveNext();)i=$t.getCurrent(),fractionList.add(new ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression(i,binaryExpression.getRight().clone(),ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.divide));for(suggestion=new ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression("constructor",ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.add,fractionList.getItem(0),fractionList.getItem(1)),$t1=Bridge.getEnumerator(Bridge.Linq.Enumerable.from(fractionList).skip(2));$t1.moveNext();)i1=$t1.getCurrent(),suggestion.add(i1);return new ThreeOneSevenBee.Model.Expression.Identity(suggestion,suggestion)}return null},commonPowerParenthesisRule:function(expression,selection){var $t,variadicExpression,baselist,item,selectionParent,suggestion,list,temp,i,indexes,result;if(selection.getCount()<2)return null;if(variadicExpression=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),Bridge.hasValue(variadicExpression)&&variadicExpression.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply&&Bridge.Linq.Enumerable.from(selection).all($_.ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules.f9)){var commonPower=null,selectionOne=Bridge.as(selection.getItem(0).getParent(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),selectionTwo=Bridge.as(selection.getItem(1).getParent(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression);if(selection.getItem(0)===selectionOne.getRight()&&selection.getItem(1)===selectionTwo.getRight())commonPower=selection.getItem(0).clone();else return null;if(!Bridge.Linq.Enumerable.from(selection).all(function(e){return ThreeOneSevenBee.Model.Expression.ExpressionBase.op_Equality(e,commonPower)}))return null;for(baselist=new ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression("constructor",ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply,selectionOne.getLeft().clone(),selectionTwo.getLeft().clone()),$t=Bridge.getEnumerator(Bridge.Linq.Enumerable.from(selection).skip(2));$t.moveNext();)if(item=$t.getCurrent(),selectionParent=Bridge.as(item.getParent(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),ThreeOneSevenBee.Model.Expression.ExpressionBase.op_Equality(item,commonPower)&&selectionParent.getRight()===item)baselist.add(selectionParent.getLeft().clone());else return null;if(suggestion=new ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression(new ThreeOneSevenBee.Model.Expression.Expressions.DelimiterExpression(baselist),commonPower,ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.power),variadicExpression.getCount()===selection.getCount())return new ThreeOneSevenBee.Model.Expression.Identity(suggestion,suggestion);for(list=new Bridge.List$1(ThreeOneSevenBee.Model.Expression.ExpressionBase)(),temp=null,i=0;i<selection.getCount();i++)temp=Bridge.as(selection.getItem(i).getParent(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),Bridge.hasValue(temp)&&list.add(temp);return indexes=Bridge.Linq.Enumerable.from(list).select(function(s){return variadicExpression.indexOfReference(s)}).where($_.ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules.f10).toList(Bridge.Int),indexes.sort(),result=Bridge.as(variadicExpression.clone(),ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),result=Bridge.get(ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules).insertSuggestion(indexes,result,suggestion),new ThreeOneSevenBee.Model.Expression.Identity(suggestion,result)}return null}}});var $_={};Bridge.ns("ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules",$_);Bridge.apply($_.ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules,{f1:function(i){return i!==-1},f2:function(a,b){return a*b},f3:function(a,b){return a+b},f4:function(i2){return i2!==-1},f5:function(s){return Bridge.is(s.getParent(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression)&&Bridge.as(s.getParent(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression).getLeft()===s||Bridge.is(s.getParent(),ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression)},f6:function(i6){return i6!==-1},f7:function(e){return Bridge.is(e,ThreeOneSevenBee.Model.Expression.Expressions.VariadicExpression)&&Bridge.as(e,ThreeOneSevenBee.Model.Expression.Expressions.VariadicExpression).getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply},f8:function(x,y){return Bridge.Linq.Enumerable.from(x).intersect(y)},f9:function(s){return Bridge.is(s.getParent(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression)&&Bridge.as(s.getParent(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression).getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.power},f10:function(i1){return i1!==-1}});Bridge.init()})(this);