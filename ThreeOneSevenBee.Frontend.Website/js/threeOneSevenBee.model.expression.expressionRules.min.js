(function(){"use strict";Bridge.define("ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules",{statics:{insertSuggestion:function(indexes,result,suggestion){for(var i=0;i<indexes.getCount();i++)result.removeAt(indexes.getItem(i)-i);return result.insert(indexes.getItem(0),suggestion),result},productToExponentRule:function(expression,selection){var product;return selection.getCount()<2?null:(product=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),Bridge.hasValue(product)&&product.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply&&Bridge.Linq.Enumerable.from(selection).where(function(e){return ThreeOneSevenBee.Model.Expression.ExpressionBase.op_Equality(selection.getItem(0),e)&&e.getParent()===expression}).count()===selection.getCount())?new ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression(selection.getItem(0).clone(),new ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression(selection.getCount()),ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.power):null},exponentToProductRule:function(expression,selection){var exponent,numericExpression,number,result,i;if(selection.getCount()!==2)return null;if(exponent=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),Bridge.hasValue(exponent)&&exponent.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.power&&selection.getItem(0).getParent()===exponent&&selection.getItem(1).getParent()===exponent){if(numericExpression=Bridge.as(exponent.getRight(),ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression),!Bridge.hasValue(numericExpression))return null;if(number=Bridge.Int.trunc(numericExpression.number),number===0)return new ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression(1);if(number===1)return exponent.getLeft().clone();if(number>1){for(result=new ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression("constructor",ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply,exponent.getLeft().clone(),exponent.getLeft().clone()),i=2;i<number;i++)result.add(exponent.getLeft().clone());return result}}return null},fractionToProductRule:function(expression,selection){var fraction=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.BinaryExpression),exponent,suggestion;return selection.getCount()===1&&selection.getItem(0)===expression&&Bridge.hasValue(fraction)&&fraction.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.divide?(exponent=new ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression(new ThreeOneSevenBee.Model.Expression.Expressions.DelimiterExpression(fraction.getRight().clone()),new ThreeOneSevenBee.Model.Expression.Expressions.UnaryMinusExpression(new ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression(1)),ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.power),suggestion=new ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression("constructor",ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply,new ThreeOneSevenBee.Model.Expression.Expressions.DelimiterExpression(fraction.getLeft().clone()),exponent),suggestion):null},removeParenthesisRule:function(expression,selection){var parenthesis=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.DelimiterExpression);return selection.getCount()===1&&parenthesis===expression&&(Bridge.is(parenthesis.getExpression(),ThreeOneSevenBee.Model.Expression.Expressions.VariableExpression)||Bridge.is(parenthesis.getExpression(),ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression)||Bridge.is(parenthesis.getExpression(),ThreeOneSevenBee.Model.Expression.Expressions.DelimiterExpression)||Bridge.is(parenthesis.getExpression(),ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression)&&Bridge.is(parenthesis.getParent(),ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression)&&Bridge.as(parenthesis.getExpression(),ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression).getType()===Bridge.as(parenthesis.getParent(),ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression).getType())?parenthesis.getExpression().clone():null},numericVariadicRule:function(expression,selection){var $t,variadicExpression,sum,operation,selectedParents,selected,numericExpression,minusExpression;if(selection.getCount()<2)return null;if(variadicExpression=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),Bridge.hasValue(variadicExpression)){if(variadicExpression.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply)sum=1,operation=$_.ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules.f1;else if(variadicExpression.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.add)sum=0,operation=$_.ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules.f2;else return null;for(selectedParents=new Bridge.List$1(ThreeOneSevenBee.Model.Expression.ExpressionBase)(),$t=Bridge.getEnumerator(selection);$t.moveNext();)if(selected=$t.getCurrent(),numericExpression=Bridge.as(selected,ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression),Bridge.hasValue(numericExpression))if(numericExpression.getParent()===expression==!0)sum=operation(sum,Bridge.Int.trunc(numericExpression.number));else if(minusExpression=Bridge.as(selected.getParent(),ThreeOneSevenBee.Model.Expression.Expressions.UnaryMinusExpression),Bridge.hasValue(minusExpression)&&minusExpression.getParent()===expression==!0)sum=operation(sum,-Bridge.Int.trunc(numericExpression.number)),selectedParents.add(minusExpression);else return null;else return null;return sum<0?new ThreeOneSevenBee.Model.Expression.Expressions.UnaryMinusExpression(new ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression(-sum)):new ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression(sum)}return null},numericBinaryRule:function(expression,selection){var binaryExpression,numericLeft,numericRight,result;if(selection.getCount()<2)return null;if(binaryExpression=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),Bridge.hasValue(binaryExpression)&&selection.getItem(0).getParent()===binaryExpression&&selection.getItem(1).getParent()===binaryExpression&&(numericLeft=Bridge.as(binaryExpression.getLeft(),ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression),numericRight=Bridge.as(binaryExpression.getRight(),ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression),Bridge.hasValue(numericLeft)&&Bridge.hasValue(numericRight))){if(binaryExpression.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.subtract)result=new ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression(numericLeft.number-numericRight.number);else if(binaryExpression.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.power)result=new ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression(Math.pow(numericLeft.number,numericRight.number));else return null;return result.number>=0?result:(result.number*=-1,new ThreeOneSevenBee.Model.Expression.Expressions.UnaryMinusExpression(result))}return null},variableWithNegativeExponent:function(expression,selection){var binaryexpression,unaryexpression;if(selection.getCount()<2)return null;if(binaryexpression=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),Bridge.hasValue(binaryexpression)&&binaryexpression.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.power&&selection.getItem(0).getParent()===binaryexpression&&selection.getItem(1).getParent()===binaryexpression&&(unaryexpression=Bridge.as(binaryexpression.getRight(),ThreeOneSevenBee.Model.Expression.Expressions.UnaryMinusExpression),Bridge.hasValue(unaryexpression)&&Bridge.hasValue(binaryexpression.getLeft())&&Bridge.hasValue(binaryexpression.getRight()))){var serializer=new ThreeOneSevenBee.Model.Expression.ExpressionSerializer,power=new ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression(binaryexpression.getLeft().clone(),unaryexpression.getExpression().clone(),ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.power);return new ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression(new ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression(1),power,ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.divide)}return null},reverseVariableWithNegativeExponent:function(expression){var binaryexpression=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),numericexpression,power,unaryminus,mysuggestion;return Bridge.hasValue(binaryexpression)&&binaryexpression.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.divide&&(numericexpression=Bridge.as(binaryexpression.getLeft(),ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression),power=Bridge.as(binaryexpression.getRight(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryExpression),Bridge.hasValue(numericexpression)&&numericexpression.getValue()==="1"&&Bridge.hasValue(power))?(unaryminus=new ThreeOneSevenBee.Model.Expression.Expressions.UnaryMinusExpression(power.getRight()),mysuggestion=new ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression(power.getLeft().clone(),unaryminus.clone(),ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.power),mysuggestion):null},addFractionsWithSameNumerators:function(expression,selection){var $t,$t1,variadicExpression,firstFraction,secondFraction,numeratorList,suggestionNumerator,i,suggestion;if(selection.getCount()<2)return null;if(variadicExpression=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),Bridge.hasValue(variadicExpression)&&variadicExpression.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.add&&(firstFraction=Bridge.as(selection.getItem(0).clone(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),secondFraction=Bridge.as(selection.getItem(1).clone(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),Bridge.hasValue(firstFraction)&&Bridge.hasValue(secondFraction)&&firstFraction.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.divide&&secondFraction.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.divide)){for(numeratorList=new Bridge.List$1(ThreeOneSevenBee.Model.Expression.ExpressionBase)(),$t=Bridge.getEnumerator(selection);$t.moveNext();){var selected=$t.getCurrent(),fraction=Bridge.as(selected,ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),minusFraction=Bridge.as(fraction.getParent(),ThreeOneSevenBee.Model.Expression.Expressions.UnaryMinusExpression);Bridge.hasValue(fraction)&&fraction.getParent()===variadicExpression&&ThreeOneSevenBee.Model.Expression.ExpressionBase.op_Equality(fraction.getRight(),firstFraction.getRight())?numeratorList.add(fraction.getLeft().clone()):Bridge.hasValue(minusFraction)&&minusFraction.getParent()===variadicExpression&&ThreeOneSevenBee.Model.Expression.ExpressionBase.op_Equality(fraction.getRight(),firstFraction.getRight())&&numeratorList.add(new ThreeOneSevenBee.Model.Expression.Expressions.UnaryMinusExpression(fraction.getLeft().clone()))}for(suggestionNumerator=new ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression("constructor",ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.add,numeratorList.getItem(0),numeratorList.getItem(1)),$t1=Bridge.getEnumerator(Bridge.Linq.Enumerable.from(numeratorList).skip(2));$t1.moveNext();)i=$t1.getCurrent(),suggestionNumerator.add(i);if(suggestion=new ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression(suggestionNumerator,firstFraction.getRight().clone(),ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.divide),variadicExpression.getCount()===selection.getCount())return suggestion}return null},exponentProduct:function(expression,selection){var $t,variadicExpression,baseSelection,variableIsPowerToOne,numeratorList,j,parent,numbers,i,suggestionNumerator,i1,suggestion;if(selection.getCount()<2)return null;if(variadicExpression=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),Bridge.hasValue(variadicExpression)&&variadicExpression.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply&&(baseSelection=selection.getItem(0).clone(),variableIsPowerToOne=new Bridge.List$1(ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression)(),Bridge.Linq.Enumerable.from(selection).all(function(s){return Bridge.is(s.getParent(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression)&&Bridge.as(s.getParent(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression).getLeft()===s&&s.getParent().getParent()===expression||s.getParent()===expression}))){if(Bridge.Linq.Enumerable.from(selection).any($_.ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules.f3))return null;for(numeratorList=new Bridge.List$1(ThreeOneSevenBee.Model.Expression.ExpressionBase)(),j=0;j<selection.getCount();j++)if(ThreeOneSevenBee.Model.Expression.ExpressionBase.op_Equality(baseSelection,selection.getItem(j)))if(parent=Bridge.as(selection.getItem(j).getParent(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),Bridge.hasValue(parent)&&parent.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.power)if(Bridge.is(parent.getRight(),ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression)){if(numbers=Bridge.cast(parent.getRight().clone(),ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),numbers.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.add)for(i=0;i<numbers.getCount();i++)numeratorList.add(numbers.getItem(i))}else numeratorList.add(parent.getRight().clone());else Bridge.is(selection.getItem(j).getParent(),ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression)&&numeratorList.add(new ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression(1));else return null;for(suggestionNumerator=null,suggestionNumerator=new ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression("constructor",ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.add,numeratorList.getItem(0),numeratorList.getItem(1)),$t=Bridge.getEnumerator(Bridge.Linq.Enumerable.from(numeratorList).skip(2));$t.moveNext();)i1=$t.getCurrent(),suggestionNumerator.add(i1);if(suggestion=new ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression(baseSelection.clone(),suggestionNumerator,ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.power),variadicExpression.getCount()===selection.getCount())return suggestion}return null},productParenthesis:function(expression,selection){var $t,$t1,variadicExpression=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),selectionBase,list,selected,selectedParent,withinDelimiter,item,DelimiterExpression,suggestion;if(!Bridge.hasValue(variadicExpression)||variadicExpression.getType()!==ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.add||selection.getCount()<2||!Bridge.Linq.Enumerable.from(selection).all($_.ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules.f4)||(selectionBase=selection.getItem(0).clone(),Bridge.Linq.Enumerable.from(selection).any(function(s){return ThreeOneSevenBee.Model.Expression.ExpressionBase.op_Inequality(s,selectionBase)})))return null;for(list=new Bridge.List$1(ThreeOneSevenBee.Model.Expression.ExpressionBase)(),$t=Bridge.getEnumerator(selection);$t.moveNext();)if(selected=$t.getCurrent(),selectedParent=Bridge.as(selected.getParent().clone(),ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),Bridge.hasValue(selectedParent)&&selectedParent.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply)selectedParent.remove(selected),selectedParent.getCount()<2?list.add(selectedParent.getItem(0)):list.add(selectedParent);else return null;if(list.getCount()<2)return null;if(withinDelimiter=new ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression("constructor",ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.add,list.getItem(0),list.getItem(1)),list.getCount()>2)for($t1=Bridge.getEnumerator(Bridge.Linq.Enumerable.from(list).skip(2));$t1.moveNext();)item=$t1.getCurrent(),withinDelimiter.add(item);return(DelimiterExpression=new ThreeOneSevenBee.Model.Expression.Expressions.DelimiterExpression(withinDelimiter),suggestion=new ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression("constructor",ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply,selectionBase,DelimiterExpression),selection.getCount()===variadicExpression.getCount())?suggestion:null},reverseProductParenthesis:function(expression,selection){var $t,$t1,$t2,variadicExpression,delimiterExpression,notParenthesis,suggestionList,expressionType,item,tempList,item1,temp,suggestion,item2;if(selection.getCount()!==2||(variadicExpression=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),!(Bridge.hasValue(variadicExpression)&&variadicExpression.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply))||!(Bridge.is(selection.getItem(0),ThreeOneSevenBee.Model.Expression.Expressions.DelimiterExpression)||Bridge.is(selection.getItem(1),ThreeOneSevenBee.Model.Expression.Expressions.DelimiterExpression))||(Bridge.is(selection.getItem(0),ThreeOneSevenBee.Model.Expression.Expressions.DelimiterExpression)?(delimiterExpression=Bridge.as(selection.getItem(0),ThreeOneSevenBee.Model.Expression.Expressions.DelimiterExpression),notParenthesis=selection.getItem(1)):(delimiterExpression=Bridge.as(selection.getItem(1),ThreeOneSevenBee.Model.Expression.Expressions.DelimiterExpression),notParenthesis=selection.getItem(0)),suggestionList=new Bridge.List$1(ThreeOneSevenBee.Model.Expression.ExpressionBase)(),expressionType=Bridge.as(delimiterExpression.getExpression(),ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),!(Bridge.hasValue(expressionType)&&expressionType.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.add)))return null;for($t=Bridge.getEnumerator(expressionType);$t.moveNext();)item=$t.getCurrent(),suggestionList.add(item);for(tempList=new Bridge.List$1(ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression)(),$t1=Bridge.getEnumerator(suggestionList);$t1.moveNext();)item1=$t1.getCurrent(),temp=new ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression("constructor",ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply,notParenthesis.clone(),item1.clone()),tempList.add(temp);for(suggestion=new ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression("constructor",ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.add,tempList.getItem(0),tempList.getItem(1)),$t2=Bridge.getEnumerator(Bridge.Linq.Enumerable.from(tempList).skip(2));$t2.moveNext();)item2=$t2.getCurrent(),suggestion.add$3(item2);return suggestion},splittingFractions:function(expression,selection){var $t,$t1,binaryExpression,numerators,fractionList,i,suggestion,i1;if(selection.getCount()!==1)return null;if(binaryExpression=Bridge.as(selection.getItem(0),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),Bridge.hasValue(binaryExpression)&&binaryExpression.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.divide&&(numerators=Bridge.as(binaryExpression.getLeft().clone(),ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),Bridge.hasValue(numerators)&&numerators.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.add&&numerators.getCount()>1)){for(fractionList=new Bridge.List$1(ThreeOneSevenBee.Model.Expression.ExpressionBase)(),$t=Bridge.getEnumerator(numerators);$t.moveNext();)i=$t.getCurrent(),fractionList.add(new ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression(i,binaryExpression.getRight().clone(),ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.divide));for(suggestion=new ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression("constructor",ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.add,fractionList.getItem(0),fractionList.getItem(1)),$t1=Bridge.getEnumerator(Bridge.Linq.Enumerable.from(fractionList).skip(2));$t1.moveNext();)i1=$t1.getCurrent(),suggestion.add(i1);return suggestion}return null},commonPowerParenthesisRule:function(expression,selection){var $t,variadicExpression,baselist,item,selectionParent,suggestion;if(selection.getCount()<2)return null;if(variadicExpression=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),Bridge.hasValue(variadicExpression)&&variadicExpression.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply&&Bridge.Linq.Enumerable.from(selection).all($_.ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules.f5)){var commonPower=null,selectionOne=Bridge.as(selection.getItem(0).getParent(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),selectionTwo=Bridge.as(selection.getItem(1).getParent(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression);if(selection.getItem(0)===selectionOne.getRight()&&selection.getItem(1)===selectionTwo.getRight())commonPower=selection.getItem(0).clone();else return null;if(!Bridge.Linq.Enumerable.from(selection).all(function(e){return ThreeOneSevenBee.Model.Expression.ExpressionBase.op_Equality(e,commonPower)}))return null;for(baselist=new ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression("constructor",ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply,selectionOne.getLeft().clone(),selectionTwo.getLeft().clone()),$t=Bridge.getEnumerator(Bridge.Linq.Enumerable.from(selection).skip(2));$t.moveNext();)if(item=$t.getCurrent(),selectionParent=Bridge.as(item.getParent(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),ThreeOneSevenBee.Model.Expression.ExpressionBase.op_Equality(item,commonPower)&&selectionParent.getRight()===item)baselist.add(selectionParent.getLeft().clone());else return null;if(suggestion=new ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression(new ThreeOneSevenBee.Model.Expression.Expressions.DelimiterExpression(baselist),commonPower,ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.power),variadicExpression.getCount()===selection.getCount())return suggestion}return null},factorizationRule:function(expression,selection){var numericExpression,n,count,a,b;if(selection.getCount()!==1)return null;if(Bridge.is(expression,ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression)&&Bridge.hasValue(expression))for(numericExpression=Bridge.as(selection.getItem(0),ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression),n=numericExpression.number,count=2;count<n;count++)if(n%count==0)return a=new ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression(count),b=new ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression(n/count),new ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression("constructor",ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply,a,b);return null},reverseCommonPowerParenthesisRule:function(expression,selection){var $t,$t1,binaryExpression,itemsInParenthesis,suggestion,commonparrent,delimiterExpression,variadicExpression,item,item1;if(selection.getCount()!==2)return null;if(binaryExpression=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),itemsInParenthesis=new Bridge.List$1(ThreeOneSevenBee.Model.Expression.ExpressionBase)(),Bridge.hasValue(binaryExpression)&&binaryExpression.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.power&&(commonparrent=binaryExpression.getRight().clone(),Bridge.is(binaryExpression.getLeft(),ThreeOneSevenBee.Model.Expression.Expressions.DelimiterExpression)&&(delimiterExpression=Bridge.as(binaryExpression.getLeft(),ThreeOneSevenBee.Model.Expression.Expressions.DelimiterExpression),Bridge.is(delimiterExpression.getExpression(),ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression)&&(variadicExpression=Bridge.as(delimiterExpression.getExpression().clone(),ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),variadicExpression.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply)))){for($t=Bridge.getEnumerator(variadicExpression);$t.moveNext();)item=$t.getCurrent(),itemsInParenthesis.add(new ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression(item,commonparrent,ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.power));if(suggestion=new ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression("constructor",ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply,itemsInParenthesis.getItem(0).clone(),itemsInParenthesis.getItem(1).clone()),itemsInParenthesis.getCount()>2){for($t1=Bridge.getEnumerator(Bridge.Linq.Enumerable.from(itemsInParenthesis).skip(2));$t1.moveNext();)item1=$t1.getCurrent(),suggestion.add(item1.clone());return suggestion}return suggestion}return null},parenthesisPowerRule:function(expression,selection){var $t,binaryOperatorExpression,exp,newExp,suggestion,power;if(selection.getCount()<2||(binaryOperatorExpression=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),!Bridge.hasValue(binaryOperatorExpression))||!Bridge.is(binaryOperatorExpression.getLeft(),ThreeOneSevenBee.Model.Expression.Expressions.DelimiterExpression))return null;for($t=Bridge.getEnumerator(selection);$t.moveNext();)if((exp=$t.getCurrent(),!Bridge.is(exp,ThreeOneSevenBee.Model.Expression.Expressions.OperatorExpression)&&!Bridge.is(exp,ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression))||(newExp=Bridge.as(exp.getParent(),ThreeOneSevenBee.Model.Expression.Expressions.OperatorExpression),Bridge.hasValue(newExp)&&newExp.getType()!==ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.power))return null;return suggestion=Bridge.as(binaryOperatorExpression.getLeft().clone(),ThreeOneSevenBee.Model.Expression.Expressions.DelimiterExpression),power=Bridge.as(suggestion.getExpression().clone(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),Bridge.hasValue(power)?new ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression(power.getLeft(),new ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression("constructor",ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply,power.getRight(),binaryOperatorExpression.getRight().clone()),ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.power):null},squareRootRule:function(expression,selection){var sqrtExp;return selection.getCount()!==1?null:(sqrtExp=Bridge.as(selection.getItem(0),ThreeOneSevenBee.Model.Expression.Expressions.FunctionExpression),!Bridge.hasValue(sqrtExp))?null:sqrtExp.getFunction()!=="sqrt"?null:new ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression(new ThreeOneSevenBee.Model.Expression.Expressions.DelimiterExpression(sqrtExp.getExpression().clone()),new ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression(new ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression(1),new ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression(2),ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.divide),ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.power)},productOfConstantAndFraction:function(expression,selection){var $t,$t1,variadicExpression,fraction,constant,numerators,suggestion;if(selection.getCount()!==2||(variadicExpression=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),!Bridge.hasValue(variadicExpression)||variadicExpression.getType()!==ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply))return null;if(fraction=null,constant=null,Bridge.hasValue(($t=Bridge.as(selection.getItem(0),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),fraction=$t,$t))&&fraction.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.divide&&selection.getItem(0).getParent()===expression)constant=Bridge.Linq.Enumerable.from(selection.getItem(1).getParentPath()).first(function(e){return e.getParent()===expression}).clone();else if(Bridge.hasValue(($t1=Bridge.as(selection.getItem(1),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),fraction=$t1,$t1))&&fraction.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.divide&&selection.getItem(1).getParent()===expression)constant=Bridge.Linq.Enumerable.from(selection.getItem(0).getParentPath()).first(function(e){return e.getParent()===expression}).clone();else return null;return numerators=new ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression("constructor",ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply,fraction.getLeft(),constant),suggestion=new ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression(numerators,fraction.getRight(),ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.divide),suggestion},divisionEqualsOneRule:function(expression,selection){var expression1;return selection.getCount()!==1?null:Bridge.hasValue(expression)&&Bridge.is(expression,ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression)&&(expression1=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),expression1.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.divide&&ThreeOneSevenBee.Model.Expression.ExpressionBase.op_Equality(expression1.getLeft(),expression1.getRight()))?new ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression(1):null},factorizeUnaryMinus:function(expression,selection){var unaryMinusExpression,numericExpression,suggestion;return selection.getCount()!==2?null:(unaryMinusExpression=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.UnaryMinusExpression),Bridge.hasValue(unaryMinusExpression))?(numericExpression=new ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression(1),suggestion=new ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression("constructor",ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply,new ThreeOneSevenBee.Model.Expression.Expressions.UnaryMinusExpression(numericExpression),unaryMinusExpression.getExpression().clone()),suggestion):null},productOfOneAndSomethingRule:function(expression,selection){var variadicExpression,one,suggestion,result,suggestion1,result1;if(selection.getCount()!==2)return null;if(variadicExpression=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),Bridge.hasValue(variadicExpression)&&variadicExpression.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply)if(Bridge.is(selection.getItem(0),ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression)){if(one=Bridge.as(selection.getItem(0),ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression),one.number===1)return suggestion=Bridge.Linq.Enumerable.from(selection.getItem(1).getParentPath()).first(function(e){return e.getParent()===expression}),result=Bridge.as(variadicExpression.clone(),ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),result=Bridge.get(ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules).insertSuggestion(Bridge.merge(new Bridge.List$1(Bridge.Int)(),[[variadicExpression.indexOfReference(selection.getItem(0))],[variadicExpression.indexOfReference(suggestion)]]),result,suggestion.clone()),suggestion.clone()}else if(Bridge.is(selection.getItem(1),ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression)){if(one=Bridge.as(selection.getItem(1),ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression),one.number===1)return suggestion1=Bridge.Linq.Enumerable.from(selection.getItem(0).getParentPath()).first(function(e){return e.getParent()===expression}).clone(),result1=Bridge.as(variadicExpression.clone(),ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),result1=Bridge.get(ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules).insertSuggestion(Bridge.merge(new Bridge.List$1(Bridge.Int)(),[[variadicExpression.indexOfReference(selection.getItem(1))],[variadicExpression.indexOfReference(suggestion1)]]),result1,suggestion1.clone()),suggestion1.clone()}else return null;return null}}});var $_={};Bridge.ns("ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules",$_);Bridge.apply($_.ThreeOneSevenBee.Model.Expression.ExpressionRules.Rules,{f1:function(a,b){return a*b},f2:function(a,b){return a+b},f3:function(s){return Bridge.hasValue(s.getParent())&&Bridge.is(s.getParent(),ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression)&&Bridge.is(s.getParent().getParent(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression)&&Bridge.as(s.getParent().getParent(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression).getLeft()===s==!1},f4:function(e){return Bridge.is(e,ThreeOneSevenBee.Model.Expression.Expressions.VariableExpression)||Bridge.is(e,ThreeOneSevenBee.Model.Expression.Expressions.NumericExpression)||Bridge.is(e,ThreeOneSevenBee.Model.Expression.Expressions.ConstantExpression)},f5:function(s){return Bridge.is(s.getParent(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression)&&Bridge.as(s.getParent(),ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression).getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.power}});Bridge.init()})(this);