(function(){"use strict";Bridge.define("ThreeOneSevenBee.Model.UI.View",{onClick:null,onKeyPressed:null,onChanged:null,config:{properties:{Width:0,Height:0,X:0,Y:0,Active:!1,Baseline:0,BackgroundColor:null,Visible:!1}},constructor:function(x,y,width,height){this.setX(x);this.setY(y);this.setActive(!1);this.setWidth(width);this.setHeight(height);this.setBaseline(height/2);this.setBackgroundColor(new ThreeOneSevenBee.Model.UI.Color("constructor"));this.setVisible(!0)},drawWithContext:function(context,offsetX,offsetY){context.drawRectangle(this.getX()+offsetX,this.getY()+offsetY,this.getWidth(),this.getHeight(),this.getBackgroundColor())},click:function(x,y){this.containsPoint(x,y)&&Bridge.hasValue(this.onClick)&&this.onClick()},keyPressed:function(key,context){if(Bridge.hasValue(this.onKeyPressed)&&this.getActive())this.onKeyPressed(key,context)},scale:function(factor){return this.setX(this.getX()*factor),this.setY(this.getY()*factor),this.setWidth(this.getWidth()*factor),this.setHeight(this.getHeight()*factor),this},containsPoint:function(x,y){return x>=this.getX()&&y>=this.getY()&&x<=this.getX()+this.getWidth()&&y<=this.getY()+this.getHeight()}});Bridge.define("ThreeOneSevenBee.Model.UI.Color",{red:0,green:0,blue:0,alpha:0,constructor:function(){ThreeOneSevenBee.Model.UI.Color.prototype.constructor$2.call(this,0,0,0,0)},constructor$1:function(red,green,blue){ThreeOneSevenBee.Model.UI.Color.prototype.constructor$2.call(this,red,green,blue,1)},constructor$2:function(red,green,blue,alpha){this.red=red;this.green=green;this.blue=blue;this.alpha=alpha}});Bridge.define("ThreeOneSevenBee.Model.UI.IContext");Bridge.define("ThreeOneSevenBee.Model.UI.Direction",{statics:{top:0,right:1,left:2,bottom:3},$enum:!0});Bridge.define("ThreeOneSevenBee.Model.UI.ParenthesisType",{statics:{left:0,right:1},$enum:!0});Bridge.define("ThreeOneSevenBee.Model.UI.ProgressbarCircle",{starLevels:null,constructor:function(levels){levels===void 0&&(levels=[]);this.starLevels=new Bridge.List$1(ThreeOneSevenBee.Model.Game.ProgressbarStar)(levels)},add:function(level){this.starLevels.contains(level)||this.starLevels.add(level)},remove:function(level){this.starLevels.contains(level)&&this.starLevels.remove(level)}});Bridge.define("ThreeOneSevenBee.Model.UI.TextAlignment",{statics:{left:0,right:1,centered:2},$enum:!0});Bridge.define("ThreeOneSevenBee.Model.UI.LabelView",{inherits:[ThreeOneSevenBee.Model.UI.View],config:{properties:{TextColor:null,Align:null,Text:null}},constructor:function(text){ThreeOneSevenBee.Model.UI.View.prototype.$constructor.call(this,0,0,10,10);this.setText(text);this.setTextColor(new ThreeOneSevenBee.Model.UI.Color("constructor$1",0,0,0));this.setAlign(ThreeOneSevenBee.Model.UI.TextAlignment.centered)},drawWithContext:function(context,offsetX,offsetY){ThreeOneSevenBee.Model.UI.View.prototype.drawWithContext.call(this,context,offsetX,offsetY);context.drawText(this.getX()+offsetX,this.getY()+offsetY,this.getWidth(),this.getHeight(),this.getText(),this.getTextColor(),this.getAlign())}});Bridge.define("ThreeOneSevenBee.Model.UI.CompositeView",{inherits:[ThreeOneSevenBee.Model.UI.View,Bridge.IEnumerable$1(ThreeOneSevenBee.Model.UI.View)],children:null,config:{properties:{PropagateClick:!1,PropagateKeypress:!1}},constructor:function(width,height){ThreeOneSevenBee.Model.UI.View.prototype.$constructor.call(this,0,0,width,height);this.children=new Bridge.List$1(ThreeOneSevenBee.Model.UI.View)();this.setPropagateClick(!0);this.setPropagateKeypress(!0)},getActive:function(){var $t,child;if(Bridge.hasValue(this.children))for($t=Bridge.getEnumerator(this.children);$t.moveNext();)if(child=$t.getCurrent(),child.getActive())return!0;return!1},setActive:function(value){var $t,child;if(value===!1&&Bridge.hasValue(this.children))for($t=Bridge.getEnumerator(this.children);$t.moveNext();)child=$t.getCurrent(),child.setActive(value);ThreeOneSevenBee.Model.UI.View.prototype.setActive.call(this,value)},drawWithContext:function(context,offsetX,offsetY){var $t,child;if(this.getVisible()===!0)for(ThreeOneSevenBee.Model.UI.View.prototype.drawWithContext.call(this,context,offsetX,offsetY),$t=Bridge.getEnumerator(this.children);$t.moveNext();)child=$t.getCurrent(),child.drawWithContext(context,offsetX+this.getX(),offsetY+this.getY())},click:function(x,y,context){var $t,child;if(ThreeOneSevenBee.Model.UI.View.prototype.containsPoint.call(this,x,y)){if(this.setActive(!0),this.getPropagateClick())for($t=Bridge.getEnumerator(this.children);$t.moveNext();)child=$t.getCurrent(),child.click(x-this.getX(),y-this.getY(),context);Bridge.hasValue(this.onClick)&&this.onClick()}else this.setActive(!1)},keyPressed:function(key,context){var $t,child;if(this.getPropagateKeypress())for($t=Bridge.getEnumerator(this.children);$t.moveNext();)child=$t.getCurrent(),child.keyPressed(key,context)},scale:function(factor){for(var child,$t=Bridge.getEnumerator(this.children);$t.moveNext();)child=$t.getCurrent(),child.scale(factor);return ThreeOneSevenBee.Model.UI.View.prototype.scale.call(this,factor)},getEnumerator$1:function(){return this.children.getEnumerator()},getEnumerator:function(){return this.getEnumerator$1()},add:function(view){this.children.add(view)},clear:function(){this.children.clear()}});Bridge.define("ThreeOneSevenBee.Model.UI.Context",{inherits:[ThreeOneSevenBee.Model.UI.IContext],contentView:null,config:{properties:{Width:0,Height:0,OnResize:null}},constructor:function(width,height){this.contentView=new ThreeOneSevenBee.Model.UI.View(0,0,0,0);this.setWidth(width);this.setHeight(height)},setContentView:function(view){this.contentView=view},draw:function(){this.clear();this.contentView.drawWithContext(this,0,0)},drawRectangle:function(x,y,width,height,fillColor){this.drawRectangle$1(x,y,width,height,fillColor,new ThreeOneSevenBee.Model.UI.Color("constructor"),0)},drawRectangle$1:function(x,y,width,height,fillColor,lineColor,lineWidth){this.drawPolygon$1([new ThreeOneSevenBee.Model.Euclidean.Vector2("constructor$1",x,y),new ThreeOneSevenBee.Model.Euclidean.Vector2("constructor$1",x+width,y),new ThreeOneSevenBee.Model.Euclidean.Vector2("constructor$1",x+width,y+height),new ThreeOneSevenBee.Model.Euclidean.Vector2("constructor$1",x,y+height)],fillColor,lineColor,lineWidth)},drawLine:function(first,second,lineColor,lineWidth){this.drawPolygon$1([first.$clone(),second.$clone()],new ThreeOneSevenBee.Model.UI.Color("constructor"),lineColor,lineWidth)},drawPolygon:function(path,fillColor){this.drawPolygon$1(path,fillColor,new ThreeOneSevenBee.Model.UI.Color("constructor"),1)}});Bridge.define("ThreeOneSevenBee.Model.UI.FrameView",{inherits:[ThreeOneSevenBee.Model.UI.View],padding:0,maxScale:0,config:{properties:{Content$1:null,PropagateClick:!1,PropagateKeypress:!1}},constructor:function(width,height){ThreeOneSevenBee.Model.UI.FrameView.prototype.constructor$2.call(this,width,height,new ThreeOneSevenBee.Model.UI.View(0,0,0,0),!0,0)},constructor$1:function(width,height,content){ThreeOneSevenBee.Model.UI.FrameView.prototype.constructor$2.call(this,width,height,content,!0,height/content.getHeight())},constructor$3:function(width,height,content,maxScale){ThreeOneSevenBee.Model.UI.FrameView.prototype.constructor$2.call(this,width,height,content,!0,maxScale)},constructor$2:function(width,height,content,propagateClick,maxScale){ThreeOneSevenBee.Model.UI.View.prototype.$constructor.call(this,0,0,width,height);this.setWidth(width);this.setHeight(height);this.setPropagateClick(propagateClick);this.setPropagateKeypress(!0);this.maxScale=maxScale;this.padding=0;this.setContent$1(this.align(this.fit(content)))},getInnerX:function(){return this.getX()-this.padding},getInnerY:function(){return this.getY()-this.padding},getInnerWidth:function(){return this.getWidth()-this.padding},getInnerHeight:function(){return this.getHeight()-this.padding},getWidth:function(){return ThreeOneSevenBee.Model.UI.View.prototype.getWidth.call(this)},setWidth:function(value){ThreeOneSevenBee.Model.UI.View.prototype.setWidth.call(this,value);Bridge.hasValue(this.getContent$1())&&this.setContent$1(this.align(this.fit(this.getContent$1())))},getActive:function(){return this.getContent$1().getActive()},setActive:function(value){Bridge.hasValue(this.getContent$1())&&this.getContent$1().setActive(value)},setContent:function(content){this.setContent$1(this.align(this.fit(content)))},updateContent:function(){this.setContent$1(this.align(this.fit(this.getContent$1())))},click:function(x,y,context){ThreeOneSevenBee.Model.UI.View.prototype.containsPoint.call(this,x,y)?(this.getPropagateClick()&&this.getContent$1().click(x-this.getX(),y-this.getY(),context),Bridge.hasValue(this.onClick)&&this.onClick()):this.setActive(!1)},keyPressed:function(key,context){this.getPropagateKeypress()&&this.getContent$1().keyPressed(key,context)},drawWithContext:function(context,offsetX,offsetY){ThreeOneSevenBee.Model.UI.View.prototype.drawWithContext.call(this,context,offsetX,offsetY);this.getContent$1().drawWithContext(context,offsetX+this.getInnerX(),offsetY+this.getInnerY())},align:function(view){return view.setX((this.getInnerWidth()-view.getWidth())/2),view.setY((this.getInnerHeight()-view.getHeight())/2),view},fit:function(view){return view.scale(Math.min(this.getInnerWidth()/view.getWidth(),Math.min(this.getInnerHeight()/view.getHeight(),this.maxScale===0?Number.MAX_VALUE:this.maxScale)))},scale:function(factor){return this.getContent$1().scale(factor),ThreeOneSevenBee.Model.UI.View.prototype.scale.call(this,factor)}});Bridge.define("ThreeOneSevenBee.Model.UI.ImageView",{inherits:[ThreeOneSevenBee.Model.UI.View],config:{properties:{Image:null}},constructor:function(image,width,height){ThreeOneSevenBee.Model.UI.View.prototype.$constructor.call(this,0,0,width,height);this.setImage(image);this.setBackgroundColor(new ThreeOneSevenBee.Model.UI.Color("constructor"))},drawWithContext:function(context,offsetX,offsetY){ThreeOneSevenBee.Model.UI.View.prototype.drawWithContext.call(this,context,offsetX,offsetY);context.drawPNGImage(this.getImage(),this.getX()+offsetX,this.getY()+offsetY,this.getWidth(),this.getHeight())}});Bridge.define("ThreeOneSevenBee.Model.UI.OperatorView",{inherits:[ThreeOneSevenBee.Model.UI.View],config:{properties:{Type:null,LineWidth:0,LineColor:null}},constructor:function(type){ThreeOneSevenBee.Model.UI.View.prototype.$constructor.call(this,0,0,10,10);this.setType(type);this.setLineWidth(1);this.setLineColor(new ThreeOneSevenBee.Model.UI.Color("constructor$1",0,0,0))},drawWithContext:function(context,offsetX,offsetY){ThreeOneSevenBee.Model.UI.View.prototype.drawWithContext.call(this,context,offsetX,offsetY);switch(this.getType()){case ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.add:context.drawText(this.getX()+offsetX,this.getY()+offsetY,this.getWidth(),this.getHeight(),"+",this.getLineColor(),ThreeOneSevenBee.Model.UI.TextAlignment.centered);break;case ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.subtract:context.drawText(this.getX()+offsetX,this.getY()+offsetY,this.getWidth(),this.getHeight(),"-",this.getLineColor(),ThreeOneSevenBee.Model.UI.TextAlignment.centered);break;case ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.minus:context.drawText(this.getX()+offsetX,this.getY()+offsetY,this.getWidth(),this.getHeight(),"-",this.getLineColor(),ThreeOneSevenBee.Model.UI.TextAlignment.centered);break;case ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.divide:context.drawLine(new ThreeOneSevenBee.Model.Euclidean.Vector2("constructor$1",this.getX()+offsetX,this.getY()+offsetY+this.getHeight()/2),new ThreeOneSevenBee.Model.Euclidean.Vector2("constructor$1",this.getX()+offsetX+this.getWidth(),this.getY()+offsetY+this.getHeight()/2),this.getLineColor(),this.getLineWidth());break;case ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply:context.drawText(this.getX()+offsetX,this.getY()+offsetY,this.getWidth(),this.getHeight(),"·",this.getLineColor(),ThreeOneSevenBee.Model.UI.TextAlignment.centered)}},scale:function(factor){return this.setLineWidth(this.getLineWidth()*factor),ThreeOneSevenBee.Model.UI.View.prototype.scale.call(this,factor)}});Bridge.define("ThreeOneSevenBee.Model.UI.ParenthesisView",{inherits:[ThreeOneSevenBee.Model.UI.View],config:{properties:{Type:null,LineColor:null,LineWidth:0}},constructor:function(type){ThreeOneSevenBee.Model.UI.View.prototype.$constructor.call(this,0,0,10,10);this.setType(type)},drawWithContext:function(context,offsetX,offsetY){context.drawText(this.getX()+offsetX,this.getY()+offsetY,this.getWidth(),this.getHeight(),this.getType()===ThreeOneSevenBee.Model.UI.ParenthesisType.left?"(":")",this.getLineColor(),ThreeOneSevenBee.Model.UI.TextAlignment.centered)},scale:function(factor){return this.setLineWidth(this.getLineWidth()*factor),ThreeOneSevenBee.Model.UI.View.prototype.scale.call(this,factor)}});Bridge.define("ThreeOneSevenBee.Model.UI.PolygonView",{inherits:[ThreeOneSevenBee.Model.UI.View],fillStyle:null,config:{properties:{model:null,cornerPositions:null}},constructor$1:function(model,fillStyle,x,y,width,height){var vector,totalAngle,angle,i;if(ThreeOneSevenBee.Model.UI.View.prototype.$constructor.call(this,x,y,width,height),this.fillStyle=fillStyle,this.setcornerPositions(new Bridge.List$1(ThreeOneSevenBee.Model.Euclidean.Vector2)()),vector=new ThreeOneSevenBee.Model.Euclidean.Vector2("constructor$1",0,0),Bridge.Linq.Enumerable.from(model.getcorners()).count()<3)throw new Bridge.Exception("[Polygonview]: Model has less than 3 corners");for(totalAngle=Math.PI*(Bridge.Linq.Enumerable.from(model.getcorners()).count()-2),angle=totalAngle/Bridge.Linq.Enumerable.from(model.getcorners()).count(),angle=Math.PI-angle,console.log("Angle: "+angle),this.getcornerPositions().add(vector.$clone()),i=1;i<Bridge.Linq.Enumerable.from(model.getcorners()).count();i++)vector.x+=Math.cos(angle*i),vector.y+=Math.sin(angle*i),this.getcornerPositions().add(vector.$clone());this.setcornerPositions(this.getcornerPositions());this.centerAndScale(width,height)},constructor:function(model,cornerPositions,fillStyle,x,y,width,height){if(ThreeOneSevenBee.Model.UI.View.prototype.$constructor.call(this,x,y,width,height),this.fillStyle=fillStyle,Bridge.Linq.Enumerable.from(model.getcorners()).count()!==Bridge.Linq.Enumerable.from(cornerPositions).count())throw new Bridge.ArgumentException("Non-equal amounts of cornerpositions("+Bridge.Linq.Enumerable.from(cornerPositions).count()+") and corners("+Bridge.Linq.Enumerable.from(model.getcorners()).count()+")!");this.setcornerPositions(cornerPositions);this.centerAndScale(width,height)},centerAndScale:function(width,height){for(var min=new ThreeOneSevenBee.Model.Euclidean.Vector2("constructor$1",Number.MAX_VALUE,Number.MAX_VALUE),max=new ThreeOneSevenBee.Model.Euclidean.Vector2("constructor$1",Number.MIN_VALUE,Number.MIN_VALUE),corner,scale,i,$t=Bridge.getEnumerator(this.getcornerPositions());$t.moveNext();)corner=$t.getCurrent(),corner.x<min.x&&(min.x=corner.x),corner.x>max.x&&(max.x=corner.x),corner.y>max.y&&(max.y=corner.y),corner.y<min.y&&(min.y=corner.y);for(max=ThreeOneSevenBee.Model.Euclidean.Vector2.op_Subtraction(max.$clone(),min.$clone()),scale=max.x-width<max.y-height?height/max.y:width/max.x,i=0;i<Bridge.Linq.Enumerable.from(this.getcornerPositions()).count();i++)this.getcornerPositions().setItem(i,ThreeOneSevenBee.Model.Euclidean.Vector2.op_Subtraction(this.getcornerPositions().getItem(i),min.$clone())),this.getcornerPositions().setItem(i,ThreeOneSevenBee.Model.Euclidean.Vector2.op_Multiply$1(this.getcornerPositions().getItem(i),scale))},drawWithContext:function(){}});Bridge.define("ThreeOneSevenBee.Model.UI.SqrtView",{inherits:[ThreeOneSevenBee.Model.UI.View],config:{properties:{SignWidth:0,TopHeight:0,LineColor:null,LineWidth:0}},constructor:function(){ThreeOneSevenBee.Model.UI.View.prototype.$constructor.call(this,0,0,30,20);this.setLineColor(new ThreeOneSevenBee.Model.UI.Color("constructor$1",0,0,0));this.setLineWidth(5);this.setSignWidth(10);this.setTopHeight(5)},drawWithContext:function(context,offsetX,offsetY){context.drawPolygon$1([new ThreeOneSevenBee.Model.Euclidean.Vector2("constructor$1",this.getX()+offsetX+this.getSignWidth()/8,this.getY()+offsetY+this.getHeight()-this.getSignWidth()/2),new ThreeOneSevenBee.Model.Euclidean.Vector2("constructor$1",this.getX()+offsetX+this.getSignWidth()/4,this.getY()+offsetY+this.getHeight()-this.getSignWidth()/2),new ThreeOneSevenBee.Model.Euclidean.Vector2("constructor$1",this.getX()+offsetX+this.getSignWidth()/2-this.getLineWidth()/2,this.getY()+offsetY+this.getHeight()),new ThreeOneSevenBee.Model.Euclidean.Vector2("constructor$1",this.getX()+offsetX+this.getSignWidth()/2,this.getY()+offsetY+this.getHeight()),new ThreeOneSevenBee.Model.Euclidean.Vector2("constructor$1",this.getX()+offsetX+this.getSignWidth(),this.getY()+offsetY+this.getTopHeight()/2),new ThreeOneSevenBee.Model.Euclidean.Vector2("constructor$1",this.getX()+offsetX+this.getWidth(),this.getY()+offsetY+this.getTopHeight()/2)],new ThreeOneSevenBee.Model.UI.Color("constructor"),this.getLineColor(),this.getLineWidth())},scale:function(factor){return this.setSignWidth(this.getSignWidth()*factor),this.setTopHeight(this.getTopHeight()*factor),this.setLineWidth(this.getLineWidth()*factor),ThreeOneSevenBee.Model.UI.View.prototype.scale.call(this,factor)},containsPoint:function(x,y){return ThreeOneSevenBee.Model.UI.View.prototype.containsPoint.call(this,x,y)&&(this.getX()+this.getSignWidth()>x||this.getY()+this.getTopHeight()>y)}});Bridge.define("ThreeOneSevenBee.Model.UI.VectorImageView",{inherits:[ThreeOneSevenBee.Model.UI.View,Bridge.IEnumerable$1(ThreeOneSevenBee.Model.Euclidean.Vector2)],config:{properties:{Path:null}},constructor:function(x,y,width,height){ThreeOneSevenBee.Model.UI.View.prototype.$constructor.call(this,x,y,width,height);this.setPath(new Bridge.List$1(ThreeOneSevenBee.Model.Euclidean.Vector2)())},add:function(x,y){this.getPath().add(new ThreeOneSevenBee.Model.Euclidean.Vector2("constructor$1",x,y))},scale:function(factor){for(var i=0;i<this.getPath().getCount();i++)this.getPath().setItem(i,ThreeOneSevenBee.Model.Euclidean.Vector2.op_Multiply$1(this.getPath().getItem(i),factor));return ThreeOneSevenBee.Model.UI.View.prototype.scale.call(this,factor)},drawWithContext:function(context,offsetX,offsetY){this.getVisible()===!0&&context.drawPolygon(Bridge.Linq.Enumerable.from(this.getPath()).select(Bridge.fn.bind(this,function(p){return new ThreeOneSevenBee.Model.Euclidean.Vector2("constructor$1",this.getX()+p.x+offsetX,this.getY()+p.y+offsetY)})).toArray(),this.getBackgroundColor())},getEnumerator$1:function(){return this.getPath().getEnumerator()},getEnumerator:function(){return this.getEnumerator$1()}});Bridge.define("ThreeOneSevenBee.Model.UI.ButtonView",{inherits:[ThreeOneSevenBee.Model.UI.LabelView],constructor:function(text,onClick){ThreeOneSevenBee.Model.UI.LabelView.prototype.$constructor.call(this," "+text+" ");this.onClick=onClick}});Bridge.define("ThreeOneSevenBee.Model.UI.ExpressionView",{inherits:[ThreeOneSevenBee.Model.UI.FrameView],statics:{nUMVAR_SIZE:20},constructor:function(){ThreeOneSevenBee.Model.UI.ExpressionView.prototype.constructor$1.call(this,0,0)},constructor$1:function(width,height){ThreeOneSevenBee.Model.UI.ExpressionView.prototype.constructor$2.call(this,null,width,height,0)},constructor$2:function(model,width,height,maxScale){ThreeOneSevenBee.Model.UI.FrameView.prototype.$constructor.call(this,width,height);this.maxScale=maxScale;this.build(model)},buildView:function(expression,model){var $t,$t1,minusExpression=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.UnaryMinusExpression),view,operatorView,minusView,operatorExpression,width,fraction,exponent,variadicExpression,view1,delimiterExpression,view2,functionExpression,view3,sqrtView,compositeView1;if(Bridge.hasValue(minusExpression))return view=this.buildView(minusExpression.getExpression(),model),view.setBackgroundColor(model.getSelected()===expression?new ThreeOneSevenBee.Model.UI.Color("constructor$1",230,230,230):new ThreeOneSevenBee.Model.UI.Color("constructor")),operatorView=new ThreeOneSevenBee.Model.UI.OperatorView(minusExpression.getType()),operatorView.setWidth(Bridge.get(ThreeOneSevenBee.Model.UI.ExpressionView).nUMVAR_SIZE/2),operatorView.setHeight(Bridge.get(ThreeOneSevenBee.Model.UI.ExpressionView).nUMVAR_SIZE),operatorView.setBaseline(Bridge.get(ThreeOneSevenBee.Model.UI.ExpressionView).nUMVAR_SIZE/2),operatorView.onClick=function(){model.select(minusExpression)},operatorView.setLineColor(expression.getSelected()?new ThreeOneSevenBee.Model.UI.Color("constructor$1",39,174,97):new ThreeOneSevenBee.Model.UI.Color("constructor$1",0,0,0)),operatorView.setLineWidth(Bridge.get(ThreeOneSevenBee.Model.UI.ExpressionView).nUMVAR_SIZE/15),view.setX(operatorView.getWidth()),operatorView.setY(view.getBaseline()-operatorView.getBaseline()),minusView=Bridge.merge(new ThreeOneSevenBee.Model.UI.CompositeView(operatorView.getWidth()+view.getWidth(),view.getHeight()),[[operatorView],[view]]),minusView.setBaseline(view.getBaseline()),minusView.setBackgroundColor(model.getSelected()===expression?new ThreeOneSevenBee.Model.UI.Color("constructor$1",230,230,230):new ThreeOneSevenBee.Model.UI.Color("constructor")),minusView;if(operatorExpression=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.BinaryOperatorExpression),Bridge.hasValue(operatorExpression)){var left=this.buildView(operatorExpression.getLeft(),model),right=this.buildView(operatorExpression.getRight(),model),operatorView1=new ThreeOneSevenBee.Model.UI.OperatorView(operatorExpression.getType());switch(operatorExpression.getType()){case ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.divide:return width=Math.max(left.getWidth(),right.getWidth())+Bridge.get(ThreeOneSevenBee.Model.UI.ExpressionView).nUMVAR_SIZE,operatorView1.setWidth(width),operatorView1.setHeight(Bridge.get(ThreeOneSevenBee.Model.UI.ExpressionView).nUMVAR_SIZE/1.5),operatorView1.setY(left.getHeight()),operatorView1.setBaseline(Bridge.get(ThreeOneSevenBee.Model.UI.ExpressionView).nUMVAR_SIZE/2),operatorView1.onClick=function(){model.select(expression)},operatorView1.setLineWidth(Bridge.get(ThreeOneSevenBee.Model.UI.ExpressionView).nUMVAR_SIZE/12),operatorView1.setLineColor(expression.getSelected()?new ThreeOneSevenBee.Model.UI.Color("constructor$1",39,174,97):new ThreeOneSevenBee.Model.UI.Color("constructor$1",0,0,0)),right.setY(left.getHeight()+operatorView1.getHeight()),left.setX((width-left.getWidth())/2),right.setX((width-right.getWidth())/2),fraction=Bridge.merge(new ThreeOneSevenBee.Model.UI.CompositeView(width,left.getHeight()+operatorView1.getHeight()+right.getHeight()),[[left],[operatorView1],[right]]),fraction.setBaseline(operatorView1.getY()+operatorView1.getHeight()/2),fraction.setBackgroundColor(model.getSelected()===expression?new ThreeOneSevenBee.Model.UI.Color("constructor$1",230,230,230):new ThreeOneSevenBee.Model.UI.Color("constructor")),fraction;case ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.power:return right.setX(left.getWidth()),left.setY(right.getHeight()-Bridge.get(ThreeOneSevenBee.Model.UI.ExpressionView).nUMVAR_SIZE/2),exponent=Bridge.merge(new ThreeOneSevenBee.Model.UI.CompositeView(right.getX()+right.getWidth(),left.getY()+left.getHeight()),[[left],[right]]),exponent.setBaseline(left.getY()+left.getBaseline()),exponent.setBackgroundColor(model.getSelected()===expression?new ThreeOneSevenBee.Model.UI.Color("constructor$1",230,230,230):new ThreeOneSevenBee.Model.UI.Color("constructor")),exponent}}if(variadicExpression=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.VariadicOperatorExpression),Bridge.hasValue(variadicExpression)){var views=new Bridge.List$1(ThreeOneSevenBee.Model.UI.View)(),offsetX=0,height=0,maxBaseline=Bridge.get(ThreeOneSevenBee.Model.UI.ExpressionView).nUMVAR_SIZE/2;for($t=Bridge.getEnumerator(variadicExpression);$t.moveNext();)(function(){var expr=$t.getCurrent(),operand,minus,operatorView2;views.getCount()!==0?(minus=Bridge.as(expr,ThreeOneSevenBee.Model.Expression.Expressions.UnaryMinusExpression),variadicExpression.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.add&&Bridge.hasValue(minus)?(operatorView2=new ThreeOneSevenBee.Model.UI.OperatorView(ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.subtract),operand=this.buildView(minus.getExpression(),model),operatorView2.onClick=function(){model.select(minus)},operatorView2.setLineColor(minus.getSelected()?new ThreeOneSevenBee.Model.UI.Color("constructor$1",40,175,100):new ThreeOneSevenBee.Model.UI.Color("constructor$1",0,0,0))):(operatorView2=new ThreeOneSevenBee.Model.UI.OperatorView(variadicExpression.getType()),operand=this.buildView(expr,model)),operatorView2.setX(offsetX),operatorView2.setWidth((variadicExpression.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply?.5:1.5)*Bridge.get(ThreeOneSevenBee.Model.UI.ExpressionView).nUMVAR_SIZE),operatorView2.setHeight(Bridge.get(ThreeOneSevenBee.Model.UI.ExpressionView).nUMVAR_SIZE),operatorView2.setBaseline(Bridge.get(ThreeOneSevenBee.Model.UI.ExpressionView).nUMVAR_SIZE/2),operatorView2.setLineWidth(Bridge.get(ThreeOneSevenBee.Model.UI.ExpressionView).nUMVAR_SIZE/(variadicExpression.getType()===ThreeOneSevenBee.Model.Expression.Expressions.OperatorType.multiply?25:15)),views.add(operatorView2),offsetX+=operatorView2.getWidth()):operand=this.buildView(expr,model);expr.getParent()===model.getSelected()&&(expr.getSelected()||Bridge.Linq.Enumerable.from(expr.getNodesRecursive()).any($_.ThreeOneSevenBee.Model.UI.ExpressionView.f1))&&operand.setBackgroundColor(new ThreeOneSevenBee.Model.UI.Color("constructor$1",230,230,230));maxBaseline=Math.max(maxBaseline,operand.getBaseline());operand.setX(offsetX);offsetX+=operand.getWidth();views.add(operand)}).call(this);for($t1=Bridge.getEnumerator(views);$t1.moveNext();)view1=$t1.getCurrent(),view1.setY(maxBaseline-view1.getBaseline()),height=Math.max(height,view1.getY()+view1.getHeight());return Bridge.merge(new ThreeOneSevenBee.Model.UI.CompositeView(offsetX,height),{children:views,setBaseline:maxBaseline})}if(delimiterExpression=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.DelimiterExpression),Bridge.hasValue(delimiterExpression)){view2=this.buildView(delimiterExpression.getExpression(),model);view2.setX(view2.getHeight()/3);view2.setY(Bridge.get(ThreeOneSevenBee.Model.UI.ExpressionView).nUMVAR_SIZE/8);var left1=Bridge.merge(new ThreeOneSevenBee.Model.UI.ParenthesisView(ThreeOneSevenBee.Model.UI.ParenthesisType.left),{onClick:function(){model.select(expression)},setWidth:view2.getHeight()/3,setHeight:view2.getHeight()+Bridge.get(ThreeOneSevenBee.Model.UI.ExpressionView).nUMVAR_SIZE/4}),right1=Bridge.merge(new ThreeOneSevenBee.Model.UI.ParenthesisView(ThreeOneSevenBee.Model.UI.ParenthesisType.right),{onClick:function(){model.select(expression)},setX:view2.getWidth()+view2.getHeight()/3,setWidth:view2.getHeight()/3,setHeight:view2.getHeight()+Bridge.get(ThreeOneSevenBee.Model.UI.ExpressionView).nUMVAR_SIZE/4}),compositeView=Bridge.merge(new ThreeOneSevenBee.Model.UI.CompositeView(view2.getWidth()+view2.getHeight()/1.5,view2.getHeight()+Bridge.get(ThreeOneSevenBee.Model.UI.ExpressionView).nUMVAR_SIZE/4),[[left1],[view2],[right1]]);return left1.setLineWidth(Bridge.get(ThreeOneSevenBee.Model.UI.ExpressionView).nUMVAR_SIZE/15),right1.setLineWidth(Bridge.get(ThreeOneSevenBee.Model.UI.ExpressionView).nUMVAR_SIZE/15),left1.setLineColor(expression.getSelected()?new ThreeOneSevenBee.Model.UI.Color("constructor$1",40,175,100):new ThreeOneSevenBee.Model.UI.Color("constructor$1",0,0,0)),right1.setLineColor(expression.getSelected()?new ThreeOneSevenBee.Model.UI.Color("constructor$1",40,175,100):new ThreeOneSevenBee.Model.UI.Color("constructor$1",0,0,0)),compositeView.setBaseline(view2.getY()+view2.getBaseline()),compositeView.setBackgroundColor(model.getSelected()===expression?new ThreeOneSevenBee.Model.UI.Color("constructor$1",230,230,230):new ThreeOneSevenBee.Model.UI.Color("constructor")),compositeView}return(functionExpression=Bridge.as(expression,ThreeOneSevenBee.Model.Expression.Expressions.FunctionExpression),Bridge.hasValue(functionExpression)&&functionExpression.getFunction()==="sqrt")?(view3=this.buildView(functionExpression.getExpression(),model),sqrtView=new ThreeOneSevenBee.Model.UI.SqrtView,sqrtView.onClick=function(){model.select(expression)},sqrtView.setSignWidth(view3.getHeight()/2),sqrtView.setTopHeight(Bridge.get(ThreeOneSevenBee.Model.UI.ExpressionView).nUMVAR_SIZE/2),sqrtView.setLineWidth(Bridge.get(ThreeOneSevenBee.Model.UI.ExpressionView).nUMVAR_SIZE/12),sqrtView.setWidth(view3.getWidth()+sqrtView.getSignWidth()+Bridge.get(ThreeOneSevenBee.Model.UI.ExpressionView).nUMVAR_SIZE/4),sqrtView.setLineColor(expression.getSelected()?new ThreeOneSevenBee.Model.UI.Color("constructor$1",40,175,100):new ThreeOneSevenBee.Model.UI.Color("constructor$1",0,0,0)),sqrtView.setHeight(view3.getHeight()+sqrtView.getTopHeight()),view3.setX(sqrtView.getSignWidth()+Bridge.get(ThreeOneSevenBee.Model.UI.ExpressionView).nUMVAR_SIZE/8),view3.setY(sqrtView.getTopHeight()),compositeView1=Bridge.merge(new ThreeOneSevenBee.Model.UI.CompositeView(sqrtView.getWidth(),sqrtView.getHeight()),[[sqrtView],[view3]]),compositeView1.setBaseline(view3.getBaseline()+sqrtView.getTopHeight()),compositeView1.setBackgroundColor(model.getSelected()===expression?new ThreeOneSevenBee.Model.UI.Color("constructor$1",230,230,230):new ThreeOneSevenBee.Model.UI.Color("constructor")),compositeView1):Bridge.merge(new ThreeOneSevenBee.Model.UI.LabelView(expression.toString()),{onClick:function(){model.select(expression)},setWidth:3*Bridge.get(ThreeOneSevenBee.Model.UI.ExpressionView).nUMVAR_SIZE/5*(expression.toString().length+.25),setHeight:Bridge.get(ThreeOneSevenBee.Model.UI.ExpressionView).nUMVAR_SIZE,setBaseline:Bridge.get(ThreeOneSevenBee.Model.UI.ExpressionView).nUMVAR_SIZE/2,setTextColor:expression.getSelected()?new ThreeOneSevenBee.Model.UI.Color("constructor$1",39,174,97):new ThreeOneSevenBee.Model.UI.Color("constructor$1",0,0,0),setBackgroundColor:model.getSelected()===expression?new ThreeOneSevenBee.Model.UI.Color("constructor$1",230,230,230):new ThreeOneSevenBee.Model.UI.Color("constructor")})},build:function(model){if(Bridge.hasValue(model)){var content=this.buildView(model.getExpression(),model);this.setContent(content)}},update:function(model){this.build(model);Bridge.hasValue(this.onChanged)&&this.onChanged()}});var $_={};Bridge.ns("ThreeOneSevenBee.Model.UI.ExpressionView",$_);Bridge.apply($_.ThreeOneSevenBee.Model.UI.ExpressionView,{f1:function(n){return n.getSelected()}});Bridge.define("ThreeOneSevenBee.Model.UI.GameView",{inherits:[ThreeOneSevenBee.Model.UI.FrameView],titleView:null,levelView:null,levelSelectView:null,context:null,constructor:function(game,context){ThreeOneSevenBee.Model.UI.FrameView.prototype.$constructor.call(this,context.getWidth(),context.getHeight());this.context=context;this.setBackgroundColor(new ThreeOneSevenBee.Model.UI.Color("constructor$1",255,255,255));this.titleView=new ThreeOneSevenBee.Model.UI.TitleView(game.getUser(),game.getPlayers());this.levelView=Bridge.merge(new ThreeOneSevenBee.Model.UI.LevelView(game),{setOnExit:Bridge.fn.bind(this,function(){game.saveLevel();this.setContent(this.levelSelectView)}),setOnNextLevel:function(){game.saveLevel();game.nextLevel()}});this.levelSelectView=Bridge.merge(new ThreeOneSevenBee.Model.UI.LevelSelectView(game.getUser()),{onChanged:Bridge.fn.bind(this,function(){this.setContent(this.levelSelectView);this.update(game);this.levelSelectView.update(game.getUser())}),onLevelSelect:Bridge.fn.bind(this,function(level){this.setContent(this.levelView);this.update(game);game.setLevel(level.levelIndex,level.categoryIndex)}),setOnExit:Bridge.fn.bind(this,$_.ThreeOneSevenBee.Model.UI.GameView.f1)});this.titleView.playButton.onClick=Bridge.fn.bind(this,$_.ThreeOneSevenBee.Model.UI.GameView.f2);this.titleView.levelButton.onClick=Bridge.fn.bind(this,$_.ThreeOneSevenBee.Model.UI.GameView.f3);game.onChanged=Bridge.fn.bind(this,this.update);this.setContent(this.titleView);context.setOnResize(Bridge.fn.bind(this,$_.ThreeOneSevenBee.Model.UI.GameView.f4));context.setContentView(this)},update:function(game){this.levelView.update(game);this.levelSelectView.update(game.getUser());this.context.draw()},setContent:function(content){ThreeOneSevenBee.Model.UI.FrameView.prototype.setContent.call(this,content);this.context.draw()}});Bridge.ns("ThreeOneSevenBee.Model.UI.GameView",$_);Bridge.apply($_.ThreeOneSevenBee.Model.UI.GameView,{f1:function(){this.setContent(this.titleView)},f2:function(){this.setContent(this.levelView)},f3:function(){this.setContent(this.levelSelectView)},f4:function(){this.updateContent()}});Bridge.define("ThreeOneSevenBee.Model.UI.IdentityMenuView",{inherits:[ThreeOneSevenBee.Model.UI.CompositeView],constructor:function(model,width,height){ThreeOneSevenBee.Model.UI.CompositeView.prototype.$constructor.call(this,width,height);this.update(model.getIdentities(),model)},update:function(identities,model){for(var views=new Bridge.List$1(ThreeOneSevenBee.Model.UI.View)(),x=0,index=0;index<identities.getCount();index++)(function(){var indexCopy=index,expressionView=new ThreeOneSevenBee.Model.UI.ExpressionView("constructor"),view=expressionView.buildView(identities.getItem(index).suggestion,model),frameView=Bridge.merge(new ThreeOneSevenBee.Model.UI.FrameView("constructor$3",this.getWidth()/identities.getCount(),this.getHeight(),view,4),{setPropagateClick:!1});frameView.setX(x);x+=frameView.getWidth();frameView.onClick=function(){model.applyIdentity(identities.getItem(indexCopy).result)};views.add(frameView)}).call(this);this.children=views},click:function(x,y,context){ThreeOneSevenBee.Model.UI.CompositeView.prototype.click.call(this,x,y,context)}});Bridge.define("ThreeOneSevenBee.Model.UI.Inputbox",{inherits:[ThreeOneSevenBee.Model.UI.LabelView],placeholder:null,cursorPos:0,hidden:!1,constructor$1:function(placeholder,hidden){ThreeOneSevenBee.Model.UI.LabelView.prototype.$constructor.call(this,placeholder);this.placeholder=placeholder;this.hidden=hidden;this.setBackgroundColor(new ThreeOneSevenBee.Model.UI.Color("constructor$1",200,200,200));this.cursorPos=0},constructor:function(placeholder){ThreeOneSevenBee.Model.UI.Inputbox.prototype.constructor$1.call(this,placeholder,!1)},click:function(x,y,context){if(this.containsPoint(x,y)?(Bridge.hasValue(this.onClick)&&this.onClick(),this.setActive(!0)):this.setActive(!1),this.getActive()===!1&&this.getText().length===0&&this.setText(this.placeholder),this.containsPoint(x,y)){this.getActive()===!0&&Bridge.String.compare(this.getText(),this.placeholder)===0&&this.setText("");for(var i=0;i<=this.getText().length;i++){if(context.getTextDimensions(this.hidden?this.getHiddenText().substr(0,i):this.getText().substr(0,i),this.getWidth(),this.getHeight()).x>x-this.getX()){this.cursorPos=i-1;break}i===this.getText().length&&(this.cursorPos=i)}}},keyPressed:function(key,context){if(this.getActive())switch(key){case"Back":this.cursorPos>0&&this.setText(Bridge.String.remove(this.getText(),--this.cursorPos,1));break;case"Right":this.cursorPos<this.getText().length&&this.cursorPos++;break;case"Space":this.setText(Bridge.String.insert(this.cursorPos,this.getText()," "));this.cursorPos++;break;case"Left":this.cursorPos>0&&this.cursorPos--;break;default:key.length===1&&(this.setText(Bridge.String.insert(this.cursorPos,this.getText(),key)),this.cursorPos++,context.getTextDimensions(this.hidden?this.getHiddenText():this.getText(),this.getWidth(),this.getHeight()).x>this.getWidth()-5&&this.keyPressed("Back",context))}},getHiddenText:function(){for(var hiddenText="",i=0;i<this.getText().length;i++)hiddenText+="*";return hiddenText},drawWithContext:function(context,offsetX,offsetY){var TextBackup,textWidth;this.hidden?(TextBackup=this.getText(),this.getText()===this.placeholder?this.setText(this.placeholder):this.setText(this.getHiddenText()),ThreeOneSevenBee.Model.UI.LabelView.prototype.drawWithContext.call(this,context,offsetX,offsetY),this.setText(TextBackup)):ThreeOneSevenBee.Model.UI.LabelView.prototype.drawWithContext.call(this,context,offsetX,offsetY);this.getActive()&&(textWidth=0,this.cursorPos>0&&this.getText().length!==0&&(textWidth=context.getTextDimensions(this.hidden?this.getHiddenText().substr(0,this.cursorPos):this.getText().substr(0,this.cursorPos),this.getWidth(),this.getHeight()).x),context.drawLine(new ThreeOneSevenBee.Model.Euclidean.Vector2("constructor$1",textWidth+offsetX+this.getX()+1,this.getY()+offsetY),new ThreeOneSevenBee.Model.Euclidean.Vector2("constructor$1",textWidth+offsetX+this.getX()+1,offsetY+this.getY()+this.getHeight()),new ThreeOneSevenBee.Model.UI.Color("constructor$1",0,0,0),1))}});Bridge.define("ThreeOneSevenBee.Model.UI.LevelSelectView",{inherits:[ThreeOneSevenBee.Model.UI.CompositeView],onLevelSelect:null,config:{properties:{OnExit:null,Category:0,MenuButton:null,ArrowLeft:null,ArrowRight:null,Levels:null,CategoryName:null,TitelView:null,StarTextView:null,StarView:null,BadgeView:null}},constructor:function(user){ThreeOneSevenBee.Model.UI.CompositeView.prototype.$constructor.call(this,400,300);this.setBackgroundColor(new ThreeOneSevenBee.Model.UI.Color("constructor$1",255,255,255));this.setCategory(user.currentCategoryIndex);this.build(user)},build:function(user){this.setMenuButton(Bridge.merge(new ThreeOneSevenBee.Model.UI.ButtonView("Menu",Bridge.fn.bind(this,$_.ThreeOneSevenBee.Model.UI.LevelSelectView.f1)),{setWidth:75,setHeight:30,setBackgroundColor:new ThreeOneSevenBee.Model.UI.Color("constructor$1",193,57,43),setTextColor:new ThreeOneSevenBee.Model.UI.Color("constructor$1",255,255,255)}));this.setTitelView(Bridge.merge(new ThreeOneSevenBee.Model.UI.CompositeView(200,40),{setX:100,setY:10}));this.setCategoryName(Bridge.merge(new ThreeOneSevenBee.Model.UI.LabelView(user.categories.getItem(this.getCategory()).name),{setWidth:this.getTitelView().getWidth()*.6,setHeight:this.getTitelView().getHeight()}));this.setStarTextView(Bridge.merge(new ThreeOneSevenBee.Model.UI.LabelView("5/27"),{setWidth:this.getTitelView().getWidth()*.25,setHeight:15,setX:this.getCategoryName().getX()+this.getCategoryName().getWidth()+7.5,setY:this.getCategoryName().getY()+this.getCategoryName().getHeight()/2-7.5}));this.setStarView(Bridge.merge(new ThreeOneSevenBee.Model.UI.ImageView("star_activated.png",this.getTitelView().getWidth()*.1,this.getTitelView().getWidth()*.1),{setX:this.getCategoryName().getX()+this.getCategoryName().getWidth()+this.getStarTextView().getWidth()+7.5,setY:this.getCategoryName().getY()+.5*this.getTitelView().getWidth()*.1}));this.setBadgeView(Bridge.merge(new ThreeOneSevenBee.Model.UI.ImageView("tutorialbadge.png",this.getTitelView().getWidth()*.1,this.getTitelView().getWidth()*.1),{setX:this.getCategoryName().getX()+this.getCategoryName().getWidth()+this.getStarTextView().getWidth()+this.getStarView().getWidth()+7.5,setY:this.getCategoryName().getY()+.5*this.getTitelView().getWidth()*.1}));this.getTitelView().add(this.getStarTextView());this.getTitelView().add(this.getCategoryName());this.getTitelView().add(this.getStarView());this.getTitelView().add(this.getBadgeView());this.setLevels(Bridge.merge(new ThreeOneSevenBee.Model.UI.FrameView("constructor",this.getWidth()-100,this.getHeight()-(this.getCategoryName().getY()+this.getCategoryName().getHeight())),{setX:50,setY:this.getCategoryName().getY()+this.getCategoryName().getHeight()}));this.setArrowRight(Bridge.merge(new ThreeOneSevenBee.Model.UI.VectorImageView(345,this.getLevels().getY()+this.getLevels().getHeight()/2-37,50,75),[[0,0],[25,37],[0,75]]));this.getArrowRight().setVisible(this.getCategory()<user.categories.getCount()-1);this.getArrowRight().setBackgroundColor(new ThreeOneSevenBee.Model.UI.Color("constructor$1",44,119,130));this.getArrowRight().onClick=Bridge.fn.bind(this,function(){this.getCategory()<user.categories.getCount()-1&&(this.setCategory(this.getCategory()+1),this.onChanged())});this.setArrowLeft(Bridge.merge(new ThreeOneSevenBee.Model.UI.VectorImageView(5,this.getLevels().getY()+this.getLevels().getHeight()/2-37,50,75),[[25,37],[50,0],[50,75]]));this.getArrowLeft().setBackgroundColor(new ThreeOneSevenBee.Model.UI.Color("constructor$1",44,119,130));this.getArrowLeft().onClick=Bridge.fn.bind(this,$_.ThreeOneSevenBee.Model.UI.LevelSelectView.f2);this.getArrowLeft().setVisible(this.getCategory()>0);this.children.add(this.getMenuButton());this.children.add(this.getArrowLeft());this.children.add(this.getArrowRight());this.children.add(this.getLevels());this.children.add(this.getTitelView());this.update(user)},update:function(user){var $t;this.getCategoryName().setText(user.categories.getItem(this.getCategory()).name);this.getArrowLeft().setVisible(this.getCategory()>0);this.getArrowRight().setVisible(this.getCategory()<user.categories.getCount()-1);var totalStars=user.categories.getItem(this.getCategory()).getCount()*3,userStarsInCategory=0,levelButtons=new ThreeOneSevenBee.Model.UI.CompositeView(400,400),levelNumber=0,numberOfLevels=user.categories.getItem(this.getCategory()).getCount();for($t=Bridge.getEnumerator(user.categories.getItem(this.getCategory()));$t.moveNext();)(function(){var level=$t.getCurrent(),levelButton,starsize,startPostition,n;for(userStarsInCategory+=level.stars,levelButton=Bridge.merge(new ThreeOneSevenBee.Model.UI.CompositeView(40,40),{onClick:Bridge.fn.bind(this,function(){this.onLevelSelect(level)}),setX:levelNumber%Bridge.Int.trunc(Math.sqrt(numberOfLevels))*50+5,setY:Bridge.Int.div(levelNumber,Bridge.Int.trunc(Math.sqrt(numberOfLevels)))*50+5,setBackgroundColor:new ThreeOneSevenBee.Model.UI.Color("constructor$1",40,130,120)}),levelButton.add(Bridge.merge(new ThreeOneSevenBee.Model.UI.LabelView((levelNumber+1).toString()),{setWidth:levelButton.getWidth(),setHeight:levelButton.getWidth()*.75,setBackgroundColor:new ThreeOneSevenBee.Model.UI.Color("constructor$1",40,130,120),setTextColor:new ThreeOneSevenBee.Model.UI.Color("constructor$1",255,255,255)})),starsize=levelButton.getWidth()*.25,startPostition=(levelButton.getWidth()-starsize)/2,level.stars===2?startPostition=levelButton.getWidth()/2-starsize:level.stars===3&&(startPostition=(levelButton.getWidth()-starsize)/2-starsize),n=0;n<level.stars;n++)levelButton.add(Bridge.merge(new ThreeOneSevenBee.Model.UI.ImageView("star_activated.png",starsize,starsize),{setY:levelButton.getHeight()-starsize,setX:startPostition})),startPostition+=starsize;levelButtons.add(levelButton);levelNumber+=1;switch(user.categories.getItem(this.getCategory()).name){case"Tutorial":this.getBadgeView().setImage("tutorialbadge.png");break;case"Potenser":this.getBadgeView().setImage("potensv2.png");break;case"Brøker":this.getBadgeView().setImage("brøkbadge.png");break;case"Parenteser":this.getBadgeView().setImage("spildonebadge.png");break;case"Master of Algebra":this.getBadgeView().setImage("masterofalgebra.png")}}).call(this);this.getStarTextView().setText(userStarsInCategory+" / "+totalStars);levelButtons.setWidth(Bridge.Int.trunc(Math.sqrt(numberOfLevels))*50);levelButtons.setHeight(Bridge.Int.div(levelNumber,Bridge.Int.trunc(Math.sqrt(numberOfLevels)))*50);this.getLevels().setContent(levelButtons)}});Bridge.ns("ThreeOneSevenBee.Model.UI.LevelSelectView",$_);Bridge.apply($_.ThreeOneSevenBee.Model.UI.LevelSelectView,{f1:function(){Bridge.hasValue(this.getOnExit())&&this.getOnExit()()},f2:function(){this.getCategory()>0&&(this.setCategory(this.getCategory()-1),this.onChanged())}});Bridge.define("ThreeOneSevenBee.Model.UI.LevelView",{inherits:[ThreeOneSevenBee.Model.UI.CompositeView],menuButton:null,nextButton:null,restartButton:null,helpButton:null,progressbar:null,identityMenu:null,expression:null,toolTipView:null,toolTipView2:null,toolTipView3:null,config:{properties:{OnExit:null,OnNextLevel:null}},constructor:function(game){ThreeOneSevenBee.Model.UI.CompositeView.prototype.$constructor.call(this,700,400);this.setBackgroundColor(new ThreeOneSevenBee.Model.UI.Color("constructor$1",255,255,255));this.build(game)},build:function(game){this.menuButton=Bridge.merge(new ThreeOneSevenBee.Model.UI.ButtonView("Menu",Bridge.fn.bind(this,$_.ThreeOneSevenBee.Model.UI.LevelView.f1)),{setWidth:100,setHeight:50,setBackgroundColor:new ThreeOneSevenBee.Model.UI.Color("constructor$1",192,57,43),setTextColor:new ThreeOneSevenBee.Model.UI.Color("constructor$1",255,255,255)});this.nextButton=Bridge.merge(new ThreeOneSevenBee.Model.UI.ButtonView("Næste",Bridge.fn.bind(this,$_.ThreeOneSevenBee.Model.UI.LevelView.f2)),{setX:this.getWidth()-100,setWidth:100,setHeight:50,setBackgroundColor:game.getIsLevelCompleted()?new ThreeOneSevenBee.Model.UI.Color("constructor$1",40,120,130):new ThreeOneSevenBee.Model.UI.Color("constructor$1",190,190,190),setTextColor:new ThreeOneSevenBee.Model.UI.Color("constructor$1",255,255,255)});this.restartButton=Bridge.merge(new ThreeOneSevenBee.Model.UI.ImageView("restart.png",30,30),{onClick:function(){game.restartLevel()},setX:110,setY:10,setBackgroundColor:new ThreeOneSevenBee.Model.UI.Color("constructor$1",192,57,43)});this.helpButton=Bridge.merge(new ThreeOneSevenBee.Model.UI.ButtonView("?",$_.ThreeOneSevenBee.Model.UI.LevelView.f3),{setX:this.getWidth()-140,setY:10,setWidth:30,setHeight:30,setBackgroundColor:new ThreeOneSevenBee.Model.UI.Color("constructor$1",40,120,130),setTextColor:new ThreeOneSevenBee.Model.UI.Color("constructor$1",255,255,255)});this.progressbar=Bridge.merge(new ThreeOneSevenBee.Model.UI.ProgressbarStarView(game.progressBar,this.getWidth()-300,30),{setX:150,setY:10});this.identityMenu=Bridge.merge(new ThreeOneSevenBee.Model.UI.IdentityMenuView(game.getExprModel(),this.getWidth(),100),{setY:this.getHeight()-125});this.expression=Bridge.merge(new ThreeOneSevenBee.Model.UI.ExpressionView("constructor$2",game.getExprModel(),this.getWidth()-100,this.getHeight()-275,8),{setX:50,setY:100});this.toolTipView=Bridge.merge(new ThreeOneSevenBee.Model.UI.ToolTipView("Denne bar viser hvor langt du er nået.",300,75),{setVisible:game.getIsFirstLevel(),setX:this.progressbar.getX(),setY:this.progressbar.getY()+this.progressbar.getHeight()+10});this.toolTipView2=Bridge.merge(new ThreeOneSevenBee.Model.UI.ToolTipView("Når knappen bliver grøn kan du gå videre til næste bane",400,75),{setVisible:game.getIsFirstLevel(),setX:this.nextButton.getX()-380,setY:this.nextButton.getY()+this.nextButton.getHeight()+10,setArrowPosition:380});this.toolTipView3=Bridge.merge(new ThreeOneSevenBee.Model.UI.ToolTipView("Dit mål er at reducere ovenstående udtryk. Dette gøres ved at markere de dele i udtrykket som skal reduceres.\nMarkér [a] og [a]. Klik derefter på den ønskede omskrivning nedenfor for at reducere udtrykket",800,90),{setVisible:game.getIsFirstLevel(),setX:this.getWidth()/2-400,setY:this.getHeight()/2+30,setArrowPosition:390});this.children=Bridge.merge(new Bridge.List$1(ThreeOneSevenBee.Model.UI.View)(),[[this.menuButton],[this.nextButton],[this.restartButton],[this.helpButton],[this.progressbar],[this.identityMenu],[this.expression],[this.toolTipView],[this.toolTipView2],[this.toolTipView3]]);Bridge.hasValue(this.onChanged)&&this.onChanged()},update:function(game){this.progressbar.update(game.progressBar);this.identityMenu.update(game.getExprModel().getIdentities(),game.getExprModel());this.expression.update(game.getExprModel());this.nextButton.setBackgroundColor(game.getIsLevelCompleted()?new ThreeOneSevenBee.Model.UI.Color("constructor$1",40,120,130):new ThreeOneSevenBee.Model.UI.Color("constructor$1",190,190,190));this.toolTipView.setVisible(game.getIsFirstLevel());this.toolTipView2.setVisible(game.getIsFirstLevel());this.toolTipView3.setVisible(game.getIsFirstLevel());Bridge.hasValue(this.onChanged)&&this.onChanged()}});Bridge.ns("ThreeOneSevenBee.Model.UI.LevelView",$_);Bridge.apply($_.ThreeOneSevenBee.Model.UI.LevelView,{f1:function(){this.getOnExit()()},f2:function(){this.getOnNextLevel()()},f3:function(){console.log("Show help")}});Bridge.define("ThreeOneSevenBee.Model.UI.LoginView",{inherits:[ThreeOneSevenBee.Model.UI.FrameView],onLogin:null,status:null,constructor:function(width,height){var username,password,submit;ThreeOneSevenBee.Model.UI.FrameView.prototype.$constructor.call(this,width,height);username=new ThreeOneSevenBee.Model.UI.Inputbox("constructor","Username");username.setX(300);username.setY(100);username.setWidth(300);username.setHeight(24);username.setAlign(ThreeOneSevenBee.Model.UI.TextAlignment.left);password=new ThreeOneSevenBee.Model.UI.Inputbox("constructor$1","Password",!0);password.setX(300);password.setY(150);password.setWidth(300);password.setHeight(24);password.setAlign(ThreeOneSevenBee.Model.UI.TextAlignment.left);submit=new ThreeOneSevenBee.Model.UI.ButtonView("Log in",Bridge.fn.bind(this,function(){if(Bridge.hasValue(this.onLogin))this.onLogin(username.getText(),password.getText())}));submit.setX(300);submit.setY(200);submit.setWidth(80);submit.setHeight(30);submit.setBackgroundColor(new ThreeOneSevenBee.Model.UI.Color("constructor$1",200,200,200));this.status=new ThreeOneSevenBee.Model.UI.LabelView(" ");this.status.setX(300);this.status.setY(250);this.status.setWidth(200);this.status.setHeight(30);this.setContent(Bridge.merge(new ThreeOneSevenBee.Model.UI.CompositeView(600,400),{children:Bridge.merge(new Bridge.List$1(ThreeOneSevenBee.Model.UI.View)(),[[username],[password],[submit],[this.status]])}))},showLoginError:function(){this.status.setText("Forkert brugernavn eller kode")}});Bridge.define("ThreeOneSevenBee.Model.UI.PlayerListView",{inherits:[ThreeOneSevenBee.Model.UI.CompositeView],config:{init:function(){this.badgeDictionary=Bridge.merge(new Bridge.Dictionary$2(ThreeOneSevenBee.Model.Game.BadgeName,String)(),[[ThreeOneSevenBee.Model.Game.BadgeName.brokBadge,"brøkbadge.png"],[ThreeOneSevenBee.Model.Game.BadgeName.masterOfAlgebra,"masterofalgebra.png"],[ThreeOneSevenBee.Model.Game.BadgeName.potens,"potensv2.png"],[ThreeOneSevenBee.Model.Game.BadgeName.tutorialBadge,"tutorialbadge.png"],[ThreeOneSevenBee.Model.Game.BadgeName.spilDoneBadge,"spildonebadge.png"]])||null}},constructor:function(players,width,height){ThreeOneSevenBee.Model.UI.CompositeView.prototype.$constructor.call(this,width,height);this.build(players);this.setBackgroundColor(new ThreeOneSevenBee.Model.UI.Color("constructor$1",209,209,209))},build:function(players){var $t,$t1,offsetY,badge;for(this.children=new Bridge.List$1(ThreeOneSevenBee.Model.UI.View)(),offsetY=5,$t=Bridge.getEnumerator(players);$t.moveNext();){var player=$t.getCurrent(),badgesWidth=(this.badgeDictionary.getCount()-1)*10,row=Bridge.merge(new ThreeOneSevenBee.Model.UI.CompositeView(this.getWidth(),20),[[Bridge.merge(new ThreeOneSevenBee.Model.UI.LabelView(" "+player.getPlayerName()+" "),{setWidth:this.getWidth()-badgesWidth-20,setHeight:20})]]);for($t1=Bridge.getEnumerator(player.badges);$t1.moveNext();)badge=$t1.getCurrent(),row.add(Bridge.merge(new ThreeOneSevenBee.Model.UI.ImageView(this.badgeDictionary.get(badge),10,10),{setX:this.getWidth()-badgesWidth+20,setY:5})),badgesWidth+=10;row.setX(5);row.setY(offsetY);row.setWidth(this.getWidth()-10);row.setBackgroundColor(new ThreeOneSevenBee.Model.UI.Color("constructor$1",239,239,239));this.children.add(row);offsetY+=25}},update:function(players){this.build(players)}});Bridge.define("ThreeOneSevenBee.Model.UI.ProgressbarStarView",{inherits:[ThreeOneSevenBee.Model.UI.CompositeView],progress:null,stars:null,constructor:function(progressbar,width,height){ThreeOneSevenBee.Model.UI.CompositeView.prototype.$constructor.call(this,width,height);this.setPropagateClick(!1);this.setBackgroundColor(new ThreeOneSevenBee.Model.UI.Color("constructor$1",225,225,225));this.build(progressbar)},build:function(progressbar){this.progress=Bridge.merge(new ThreeOneSevenBee.Model.UI.View(0,0,Math.min(this.getWidth(),Math.max(0,this.getWidth()*progressbar.getPercentage())),this.getHeight()),{setBackgroundColor:new ThreeOneSevenBee.Model.UI.Color("constructor$1",40,175,100)});this.stars=new Bridge.List$1(ThreeOneSevenBee.Model.UI.ImageView)();this.stars.addRange(Bridge.Linq.Enumerable.from(progressbar.activatedStarPercentages()).select(Bridge.fn.bind(this,$_.ThreeOneSevenBee.Model.UI.ProgressbarStarView.f1)));this.stars.addRange(Bridge.Linq.Enumerable.from(progressbar.deactivatedStarPercentages()).select(Bridge.fn.bind(this,$_.ThreeOneSevenBee.Model.UI.ProgressbarStarView.f2)));this.children=new Bridge.List$1(ThreeOneSevenBee.Model.UI.View)();this.children.add(this.progress);this.children.addRange(this.stars)},update:function(progressbar){this.build(progressbar)}});Bridge.ns("ThreeOneSevenBee.Model.UI.ProgressbarStarView",$_);Bridge.apply($_.ThreeOneSevenBee.Model.UI.ProgressbarStarView,{f1:function(starPercentage){return Bridge.merge(new ThreeOneSevenBee.Model.UI.ImageView("star_activated.png",this.getHeight(),this.getHeight()),{setX:starPercentage*this.getWidth()-this.getHeight()})},f2:function(starPercentage){return Bridge.merge(new ThreeOneSevenBee.Model.UI.ImageView("star.png",this.getHeight(),this.getHeight()),{setX:starPercentage*this.getWidth()-this.getHeight()})}});Bridge.define("ThreeOneSevenBee.Model.UI.TitleView",{inherits:[ThreeOneSevenBee.Model.UI.CompositeView],welcomeText:null,levelButton:null,playButton:null,playerList:null,constructor:function(user,players){var playIcon;ThreeOneSevenBee.Model.UI.CompositeView.prototype.$constructor.call(this,600,300);this.setBackgroundColor(new ThreeOneSevenBee.Model.UI.Color("constructor$1",255,255,255));this.welcomeText=Bridge.merge(new ThreeOneSevenBee.Model.UI.LabelView("Velkommen "+user.getPlayerName()),{setX:100,setY:50,setHeight:50,setWidth:220});playIcon=Bridge.merge(new ThreeOneSevenBee.Model.UI.VectorImageView(0,0,100,100),[[25,25],[75,50],[25,75]]);playIcon.setBackgroundColor(new ThreeOneSevenBee.Model.UI.Color("constructor$1",255,255,255));this.playButton=Bridge.merge(new ThreeOneSevenBee.Model.UI.CompositeView(100,100),[[playIcon]]);this.playButton.setBackgroundColor(new ThreeOneSevenBee.Model.UI.Color("constructor$1",39,174,97));this.playButton.setX(100);this.playButton.setY(100);var levelIcon1=Bridge.merge(new ThreeOneSevenBee.Model.UI.VectorImageView(0,0,100,100),[[20,20],[45,20],[45,45],[20,45],[20,20]]),levelIcon2=Bridge.merge(new ThreeOneSevenBee.Model.UI.VectorImageView(0,0,100,100),[[80,20],[80,45],[55,45],[55,20],[80,20]]),levelIcon3=Bridge.merge(new ThreeOneSevenBee.Model.UI.VectorImageView(0,0,100,100),[[80,80],[55,80],[55,55],[80,55],[80,80]]),levelIcon4=Bridge.merge(new ThreeOneSevenBee.Model.UI.VectorImageView(0,0,100,100),[[20,80],[20,55],[45,55],[45,80],[20,80]]);levelIcon1.setBackgroundColor(new ThreeOneSevenBee.Model.UI.Color("constructor$1",255,255,255));levelIcon2.setBackgroundColor(new ThreeOneSevenBee.Model.UI.Color("constructor$1",255,255,255));levelIcon3.setBackgroundColor(new ThreeOneSevenBee.Model.UI.Color("constructor$1",255,255,255));levelIcon4.setBackgroundColor(new ThreeOneSevenBee.Model.UI.Color("constructor$1",255,255,255));this.levelButton=Bridge.merge(new ThreeOneSevenBee.Model.UI.CompositeView(100,100),[[levelIcon1],[levelIcon2],[levelIcon3],[levelIcon4]]);this.levelButton.setBackgroundColor(new ThreeOneSevenBee.Model.UI.Color("constructor$1",42,128,185));this.levelButton.setX(220);this.levelButton.setY(100);this.playerList=Bridge.merge(new ThreeOneSevenBee.Model.UI.PlayerListView(players,160,200),{setX:340,setY:50});this.children=Bridge.merge(new Bridge.List$1(ThreeOneSevenBee.Model.UI.View)(),[[this.welcomeText],[this.levelButton],[this.playerList],[this.playButton]])}});Bridge.define("ThreeOneSevenBee.Model.UI.ToolTipView",{inherits:[ThreeOneSevenBee.Model.UI.CompositeView],arrowPosition:0,arrowDirection:null,config:{properties:{labelView:null,arrow:null}},constructor:function(text,width,height){ThreeOneSevenBee.Model.UI.CompositeView.prototype.$constructor.call(this,width,height);this.setarrow(Bridge.merge(new ThreeOneSevenBee.Model.UI.VectorImageView(0,0,20,11),[[0,11],[10,0],[20,11]]));this.setlabelView(Bridge.merge(new ThreeOneSevenBee.Model.UI.LabelView(text),{setY:10,setHeight:height-10,setWidth:width}));this.setText(text);this.setBoxColor(new ThreeOneSevenBee.Model.UI.Color("constructor$1",40,130,120));this.setTextColor(new ThreeOneSevenBee.Model.UI.Color("constructor$1",255,255,255));this.setArrowDirection(ThreeOneSevenBee.Model.UI.Direction.top);this.setArrowPosition(0);this.children.add(this.getarrow());this.children.add(this.getlabelView())},getBoxColor:function(){return this.getlabelView().getBackgroundColor()},setBoxColor:function(value){this.getlabelView().setBackgroundColor(value);this.getarrow().setBackgroundColor(value)},getTextColor:function(){return this.getlabelView().getTextColor()},setTextColor:function(value){this.getlabelView().setTextColor(value)},getText:function(){return this.getlabelView().getText()},setText:function(value){this.getlabelView().setText(value)},getArrowPosition:function(){return this.arrowPosition},setArrowPosition:function(value){this.arrowPosition=value;switch(this.getArrowDirection()){case ThreeOneSevenBee.Model.UI.Direction.top:this.getarrow().setX(this.arrowPosition);break;case ThreeOneSevenBee.Model.UI.Direction.right:this.getarrow().setY(this.arrowPosition);break;case ThreeOneSevenBee.Model.UI.Direction.left:this.getarrow().setY(this.arrowPosition);break;case ThreeOneSevenBee.Model.UI.Direction.bottom:this.getarrow().setX(this.arrowPosition)}},getArrowDirection:function(){return this.arrowDirection},setArrowDirection:function(value){this.arrowDirection=value;this.arrowPosition=0;this.getlabelView().setX(0);this.getlabelView().setY(0);this.getlabelView().setHeight(this.getHeight());this.getlabelView().setWidth(this.getWidth());switch(this.arrowDirection){case ThreeOneSevenBee.Model.UI.Direction.top:this.setarrow(Bridge.merge(new ThreeOneSevenBee.Model.UI.VectorImageView(0,0,20,10),[[0,10],[10,0],[20,10]]));this.getlabelView().setY(10);this.getlabelView().setHeight(this.getHeight()-10);break;case ThreeOneSevenBee.Model.UI.Direction.right:this.setarrow(Bridge.merge(new ThreeOneSevenBee.Model.UI.VectorImageView(this.getWidth()-10,0,10,20),[[0,0],[10,10],[0,20]]));this.getlabelView().setWidth(this.getWidth()-10);break;case ThreeOneSevenBee.Model.UI.Direction.left:this.setarrow(Bridge.merge(new ThreeOneSevenBee.Model.UI.VectorImageView(0,0,10,20),[[10,0],[0,10],[10,20]]));this.getlabelView().setX(10);this.getlabelView().setWidth(this.getWidth()-10);break;case ThreeOneSevenBee.Model.UI.Direction.bottom:this.setarrow(Bridge.merge(new ThreeOneSevenBee.Model.UI.VectorImageView(0,this.getHeight()-10,20,10),[[0,0],[20,0],[10,10]]));this.getlabelView().setHeight(this.getHeight()-10)}this.getarrow().setBackgroundColor(this.getBoxColor())}});Bridge.init()})(this);